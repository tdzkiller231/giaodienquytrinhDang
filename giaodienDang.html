<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quy Tr√¨nh Ph√°t Tri·ªÉn ƒê·∫£ng - L·ªõp Nh·∫≠n Th·ª©c</title>
    <!-- T·∫£i Tailwind CSS cho styling c∆° b·∫£n v√† responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- C·∫•u h√¨nh Tailwind cho Font Inter (m·∫∑c ƒë·ªãnh) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-red': '#C00000', // M√†u ƒë·ªè ch·ªß ƒë·∫°o
                        'bg-light': '#f9fafb',
                    }
                }
            }
        }
    </script>
    <!-- Link Font Awesome ƒë·ªÉ d√πng Icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* CSS tu·ª≥ ch·ªânh cho Navigation ch√≠nh */
        .nav-step {
            transition: all 0.3s ease;
            position: relative;
            flex-grow: 1;
        }
        .nav-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 50%;
            right: -1px;
            transform: translateY(-50%);
            width: 1px;
            height: 60%;
            background-color: rgba(220, 220, 220, 0.7);
        }
        .nav-step.active .step-icon {
            color: #ffffff;
        }
        .nav-step.active {
            background-color: #C00000;
            color: #ffffff;
            z-index: 10;
            box-shadow: 0 4px 10px rgba(192, 0, 0, 0.3);
        }
        .nav-step:hover:not(.active) {
            background-color: #f3f4f6;
        }

        /* CSS cho Slide-in (Chi ti·∫øt h·ªì s∆°) */
        .slide-in-panel {
            transition: transform 0.4s ease-in-out;
            transform: translateX(100%);
        }
        .slide-in-panel.open {
            transform: translateX(0);
        }
        /* CSS cho Modal Overlay */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
        }
        /* Input required red border (CSS validation) */
        input:required:not(:placeholder-shown):invalid, select:required:not([value=""]):invalid {
            border-color: #ef4444; /* red-500 */
        }

        /* ·∫®n thanh cu·ªôn d·ªçc (ch·ªâ cho slide-in ƒë·ªÉ tr√¥ng m∆∞·ª£t m√† h∆°n) */
        .slide-in-panel::-webkit-scrollbar {
            width: 0;
        }
        .slide-in-panel {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

<div class="container mx-auto p-4 sm:p-8 mt-6">
    <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
        
        <!-- Thanh Ti√™u ƒë·ªÅ -->
        <header class="mb-6 border-b pb-4">
            <h1 class="text-3xl font-extrabold text-primary-red">Quy tr√¨nh Ph√°t tri·ªÉn ƒê·∫£ng</h1>
            <p class="text-gray-600 mt-1">T·ªïng quan v√† qu·∫£n l√Ω to√†n b·ªô quy tr√¨nh ph√°t tri·ªÉn ƒë·∫£ng vi√™n</p>
        </header>

        <!-- Thanh Navigation 5 B∆∞·ªõc -->
        <div id="processNav" class="process-navigation flex flex-wrap md:flex-nowrap bg-gray-50 rounded-lg shadow-inner overflow-hidden">
            
            <!-- D·ªØ li·ªáu 5 B∆∞·ªõc -->
            <div 
                class="nav-step p-3 sm:p-4 text-center cursor-pointer flex flex-col items-center justify-center border-b-2 border-transparent md:border-b-0 md:border-r" 
                data-target="quan-chung" 
                data-title="Qu·∫ßn Ch√∫ng ∆Øu T√∫"
                data-desc="Qu·∫£n l√Ω danh s√°ch qu·∫ßn ch√∫ng v√† tr·∫°ng th√°i t·ª´ng h·ªì s∆°"
                data-url="quan_ly_quan_chung_uu_tu.html"
            >
                <i class="fas fa-users step-icon text-gray-500 text-2xl mb-1"></i>
                <span class="text-sm font-semibold whitespace-nowrap">Qu·∫ßn Ch√∫ng ∆Øu T√∫</span>
            </div>

            <div 
                class="nav-step p-3 sm:p-4 text-center cursor-pointer flex flex-col items-center justify-center border-b-2 border-transparent md:border-b-0 md:border-r" 
                data-target="lop-nhan-thuc" 
                data-title="L·ªõp Nh·∫≠n Th·ª©c"
                data-desc="Qu·∫£n l√Ω danh s√°ch l·ªõp h·ªçc v√† g√°n h·ªì s∆° v√†o l·ªõp"
                data-url="quan_ly_lop_nhan_thuc.html"
            >
                <i class="fas fa-book-open step-icon text-gray-500 text-2xl mb-1"></i>
                <span class="text-sm font-semibold whitespace-nowrap">L·ªõp Nh·∫≠n Th·ª©c</span>
            </div>

            <div 
                class="nav-step p-3 sm:p-4 text-center cursor-pointer flex flex-col items-center justify-center border-b-2 border-transparent md:border-b-0 md:border-r" 
                data-target="ren-luyen" 
                data-title="R√®n Luy·ªán Th·ª≠ Th√°ch"
                data-desc="Qu·∫£n l√Ω ng∆∞·ªùi h∆∞·ªõng d·∫´n v√† h·ªì s∆° trong th·ª≠ th√°ch"
                data-url="quan_ly_ren_luyen_thu_thach.html"
            >
                <i class="fas fa-user-tie step-icon text-gray-500 text-2xl mb-1"></i>
                <span class="text-sm font-semibold whitespace-nowrap">R√®n Luy·ªán Th·ª≠ Th√°ch</span>
            </div>

            <div 
                class="nav-step p-3 sm:p-4 text-center cursor-pointer flex flex-col items-center justify-center border-b-2 border-transparent md:border-b-0 md:border-r" 
                data-target="hoan-thien" 
                data-title="Ho√†n Thi·ªán H·ªì S∆°"
                data-desc="Qu·∫£n l√Ω checklist h·ªì s∆° t·ª´ng ƒë·ªëi t∆∞·ª£ng"
                data-url="quan_ly_hoan_thien_ho_so.html"
            >
                <i class="fas fa-file-alt step-icon text-gray-500 text-2xl mb-1"></i>
                <span class="text-sm font-semibold whitespace-nowrap">Ho√†n Thi·ªán H·ªì S∆°</span>
            </div>

            <div 
                class="nav-step p-3 sm:p-4 text-center cursor-pointer flex flex-col items-center justify-center border-b-2 border-transparent md:border-b-0" 
                data-target="ket-nap" 
                data-title="Quy·∫øt ƒê·ªãnh K·∫øt N·∫°p"
                data-desc="Qu·∫£n l√Ω c√°c quy·∫øt ƒë·ªãnh k·∫øt n·∫°p"
                data-url="quan_ly_quyet_dinh_ket_nap.html"
            >
                <i class="fas fa-check-circle step-icon text-gray-500 text-2xl mb-1"></i>
                <span class="text-sm font-semibold whitespace-nowrap">Quy·∫øt ƒê·ªãnh K·∫øt N·∫°p</span>
            </div>
        </div>
        
        <!-- V√πng N·ªôi dung ch√≠nh (S·∫Ω ƒë∆∞·ª£c fill b·ªüi JS) -->
        <div id="mainContent" class="content mt-6">
             <!-- N·ªôi dung Qu·∫ßn l√Ω Quy tr√¨nh s·∫Ω ƒë∆∞·ª£c render ·ªü ƒë√¢y -->
        </div>

    </div>
</div>

<!-- Modal 1: L·ª±a ch·ªçn ph∆∞∆°ng th·ª©c Th√™m m·ªõi QCUT -->
<div id="modalAddNewOption" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay">
    <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-sm mx-auto transform transition-all duration-300 scale-95 opacity-0" id="modalAddNewOptionInner">
        <h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">Th√™m m·ªõi H·ªì s∆°</h3>
        <p class="text-gray-600 mb-6">Vui l√≤ng ch·ªçn ngu·ªìn d·ªØ li·ªáu cho h·ªì s∆° m·ªõi:</p>
        
        <div class="space-y-4">
            <button id="btnSelectHSNV" onclick="openSelectHSNVModal()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-150 shadow-md">
                <i class="fas fa-user-plus mr-2"></i> Ch·ªçn t·ª´ H·ªì s∆° Nh√¢n vi√™n
            </button>
            <button id="btnManualEntry" onclick="openManualEntry()" class="w-full bg-primary-red text-white py-3 rounded-lg font-semibold hover:bg-red-700 transition duration-150 shadow-md">
                <i class="fas fa-keyboard mr-2"></i> Nh·∫≠p tay
            </button>
        </div>
        <button onclick="closeModal('modalAddNewOption')" class="mt-6 w-full text-gray-600 py-2 border rounded-lg hover:bg-gray-50 transition duration-150">H·ªßy</button>
    </div>
</div>

<!-- Modal 1.5: Ch·ªçn t·ª´ H·ªì s∆° Nh√¢n vi√™n -->
<div id="modalSelectHSNV" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-5xl mx-auto transform transition-all duration-300 scale-95 opacity-0" id="modalSelectHSNVInner">
        <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
            <h3 class="text-2xl font-bold text-gray-800">Ch·ªçn t·ª´ H·ªì s∆° Nh√¢n vi√™n</h3>
            <button onclick="closeModal('modalSelectHSNV')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="p-6">
            <!-- B·ªô l·ªçc -->
            <div class="bg-gray-50 p-4 rounded-lg border mb-4">
                <h4 class="font-semibold text-gray-700 mb-3">T√¨m ki·∫øm v√† l·ªçc</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <input type="text" id="filterHSNVName" placeholder="T√¨m theo t√™n..." class="px-3 py-2 border rounded-lg" onkeyup="filterHSNVList()">
                    <input type="text" id="filterHSNVCode" placeholder="T√¨m theo m√£ NV..." class="px-3 py-2 border rounded-lg" onkeyup="filterHSNVList()">
                    <select id="filterHSNVUnit" class="px-3 py-2 border rounded-lg" onchange="filterHSNVList()">
                        <option value="">-- T·∫•t c·∫£ ƒë∆°n v·ªã --</option>
                        <option value="Ph√≤ng K·∫ø to√°n">Ph√≤ng K·∫ø to√°n</option>
                        <option value="Ban L√£nh ƒë·∫°o">Ban L√£nh ƒë·∫°o</option>
                        <option value="Ph√≤ng H√†nh ch√≠nh">Ph√≤ng H√†nh ch√≠nh</option>
                    </select>
                </div>
            </div>

            <!-- Danh s√°ch HSNV -->
            <div id="hsnvListContainer" class="overflow-x-auto bg-white rounded-lg shadow border max-h-96 overflow-y-auto">
                <!-- Table s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
            </div>
        </div>

        <div class="p-6 pt-4 border-t flex justify-end">
            <button onclick="closeModal('modalSelectHSNV')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">ƒê√≥ng</button>
        </div>
    </div>
</div>

<!-- Modal 2: Form Nh·∫≠p/S·ª≠a H·ªì s∆° QCUT (ƒê·∫ßy ƒë·ªß 44 tr∆∞·ªùng) -->
<div id="modalDataEntry" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-6xl mx-auto transform transition-all duration-300 scale-95 opacity-0" id="modalDataEntryInner">
        <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
            <h3 class="text-2xl font-bold text-gray-800">Th√¥ng tin Qu·∫ßn Ch√∫ng ∆Øu T√∫</h3>
            <button onclick="closeModal('modalDataEntry')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <form id="qcForm" class="p-6">
            <input type="hidden" id="qcRecordId" value="">
            <input type="hidden" id="fromHSNV" value="false">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                
                <!-- I. TH√îNG TIN C∆† B·∫¢N -->
                <div class="md:col-span-2 text-primary-red font-bold text-lg mb-2 pt-4 border-t-2 border-primary-red">I. TH√îNG TIN C∆† B·∫¢N</div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        1. H·ªç v√† t√™n <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="hoTen" name="hoTen" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        2. M√£ nh√¢n vi√™n
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="maNV" name="maNV" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        3. ƒê∆°n v·ªã / Chi b·ªô tr·ª±c thu·ªôc <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="donVi" name="donVi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required onchange="updateChiBoCha()">
                        <option value="">-- Ch·ªçn ƒê∆°n v·ªã/Chi b·ªô --</option>
                        <option value="Chi b·ªô Ph√≤ng K·∫ø to√°n">Chi b·ªô Ph√≤ng K·∫ø to√°n</option>
                        <option value="Chi b·ªô Ban L√£nh ƒë·∫°o">Chi b·ªô Ban L√£nh ƒë·∫°o</option>
                        <option value="Chi b·ªô Ph√≤ng H√†nh ch√≠nh">Chi b·ªô Ph√≤ng H√†nh ch√≠nh</option>
                        <option value="Chi b·ªô Ph√≤ng Kinh doanh">Chi b·ªô Ph√≤ng Kinh doanh</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        4. T√™n CSƒê tr·ª±c thu·ªôc (ƒê·∫£ng b·ªô/Chi b·ªô cha)
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="chiBoCha" name="chiBoCha" class="mt-1 block w-full rounded-md border-gray-300 bg-gray-100 shadow-sm p-2 border" value="ƒê·∫£ng ·ªßy Kh·ªëi C∆° quan" readonly>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        5. Ch·ª©c danh (ch·ª©c v·ª• trong c∆° quan) <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="chucDanh" name="chucDanh" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        8. Ch·ª©c danh ch√≠nh quy·ªÅn
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="chucDanhChinhQuyen" name="chucDanhChinhQuyen" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        9. Ch·ª©c danh ƒëo√†n th·ªÉ
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="chucDanhDoanThe" name="chucDanhDoanThe" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="VD: B√≠ th∆∞ ƒêo√†n">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        12. Gi·ªõi t√≠nh <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="gioiTinh" name="gioiTinh" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                        <option value="">-- Ch·ªçn --</option>
                        <option value="Nam">Nam</option>
                        <option value="N·ªØ">N·ªØ</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        13. Ng√†y sinh <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="date" id="ngaySinh" name="ngaySinh" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        15. S·ªë CMND/CCCD <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="cccd" name="cccd" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        16. D√¢n t·ªôc
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="danToc" name="danToc" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        <option value="">-- Ch·ªçn --</option>
                        <option value="Kinh">Kinh</option>
                        <option value="T√†y">T√†y</option>
                        <option value="Th√°i">Th√°i</option>
                        <option value="M∆∞·ªùng">M∆∞·ªùng</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        17. T√¥n gi√°o
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="tonGiao" name="tonGiao" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        <option value="">-- Ch·ªçn --</option>
                        <option value="Kh√¥ng">Kh√¥ng</option>
                        <option value="Ph·∫≠t gi√°o">Ph·∫≠t gi√°o</option>
                        <option value="C√¥ng gi√°o">C√¥ng gi√°o</option>
                        <option value="Tin l√†nh">Tin l√†nh</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        18. Ng√†y ti·∫øp nh·∫≠n <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="date" id="ngayTiepNhan" name="ngayTiepNhan" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                
                <!-- II. TH√îNG TIN ƒê·ªäA CH·ªà -->
                <div class="md:col-span-2 text-primary-red font-bold text-lg mb-2 pt-4 border-t-2 border-primary-red">II. TH√îNG TIN ƒê·ªäA CH·ªà</div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        19. N∆°i sinh (T·ªânh/TP) <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="noiSinhTP" name="noiSinhTP" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                        <option value="">-- Ch·ªçn T·ªânh/TP --</option>
                        <option value="H√† N·ªôi">H√† N·ªôi</option>
                        <option value="H·ªì Ch√≠ Minh">H·ªì Ch√≠ Minh</option>
                        <option value="ƒê√† N·∫µng">ƒê√† N·∫µng</option>
                        <option value="H·∫£i Ph√≤ng">H·∫£i Ph√≤ng</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        20. N∆°i sinh (Ph∆∞·ªùng/X√£) <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="noiSinhPhuong" name="noiSinhPhuong" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                        <option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>
                        <option value="Ph∆∞·ªùng ƒê·ªëng ƒêa">Ph∆∞·ªùng ƒê·ªëng ƒêa</option>
                        <option value="Ph∆∞·ªùng L√°ng H·∫°">Ph∆∞·ªùng L√°ng H·∫°</option>
                    </select>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">
                        21. ƒê·ªãa ch·ªâ n∆°i sinh
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="diaChiNoiSinh" name="diaChiNoiSinh" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        22. Qu√™ qu√°n (T·ªânh/TP) <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="queQuanTP" name="queQuanTP" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                        <option value="">-- Ch·ªçn T·ªânh/TP --</option>
                        <option value="H√† N·ªôi">H√† N·ªôi</option>
                        <option value="H·ªì Ch√≠ Minh">H·ªì Ch√≠ Minh</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        23. Qu√™ qu√°n (Ph∆∞·ªùng/X√£) <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="queQuanPhuong" name="queQuanPhuong" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                        <option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>
                        <option value="X√£ ƒê√¥ng Anh">X√£ ƒê√¥ng Anh</option>
                    </select>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">
                        24. ƒê·ªãa ch·ªâ qu√™ qu√°n
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="diaChiQueQuan" name="diaChiQueQuan" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">25. N∆°i ·ªü hi·ªán nay (T·ªânh/TP)</label>
                    <select id="noiOHienNayTP" name="noiOHienNayTP" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        <option value="">-- Ch·ªçn T·ªânh/TP --</option>
                        <option value="H√† N·ªôi">H√† N·ªôi</option>
                        <option value="H·ªì Ch√≠ Minh">H·ªì Ch√≠ Minh</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">26. N∆°i ·ªü hi·ªán nay (Ph∆∞·ªùng/X√£)</label>
                    <select id="noiOHienNayPhuong" name="noiOHienNayPhuong" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                        <option value="">-- Ch·ªçn Ph∆∞·ªùng/X√£ --</option>
                    </select>
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">27. ƒê·ªãa ch·ªâ n∆°i ·ªü hi·ªán nay</label>
                    <input type="text" id="diaChiNoiOHienNay" name="diaChiNoiOHienNay" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="S·ªë nh√†, ƒë∆∞·ªùng, t·ªï, khu ph·ªë">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        28. T·ªânh/TP th∆∞·ªùng tr√∫ <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <select id="thuongTruTP" name="thuongTruTP" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                        <option value="">-- Ch·ªçn T·ªânh/TP --</option>
                        <option value="H√† N·ªôi">H√† N·ªôi</option>
                        <option value="H·ªì Ch√≠ Minh">H·ªì Ch√≠ Minh</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        29. ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫ <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="diaChiThuongTru" name="diaChiThuongTru" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required placeholder="S·ªë nh√†, ƒë∆∞·ªùng, t·ªï, khu ph·ªë">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">30. Th√†nh ph·∫ßn gia ƒë√¨nh</label>
                    <input type="text" id="thanhPhanGiaDinh" name="thanhPhanGiaDinh" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <!-- III. TH√îNG TIN C√îNG T√ÅC -->
                <div class="md:col-span-2 text-primary-red font-bold text-lg mb-2 pt-4 border-t-2 border-primary-red">III. TH√îNG TIN C√îNG T√ÅC</div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        31. Ngh·ªÅ nghi·ªáp tr∆∞·ªõc khi tuy·ªÉn d·ª•ng
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="ngheNghiepTruocTuyenDung" name="ngheNghiepTruocTuyenDung" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        32. Ng√†y ƒë∆∞·ª£c tuy·ªÉn d·ª•ng
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="date" id="ngayTuyenDung" name="ngayTuyenDung" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">33. ƒê∆°n v·ªã tuy·ªÉn d·ª•ng</label>
                    <input type="text" id="donViTuyenDung" name="donViTuyenDung" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        34. Ng√†y v√†o c∆° quan hi·ªán ƒëang c√¥ng t√°c
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="date" id="ngayVaoCoQuan" name="ngayVaoCoQuan" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        35. B·ªô ph·∫≠n c√¥ng t√°c (Ph√≤ng/ƒê∆°n v·ªã) <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="boPhanCongTac" name="boPhanCongTac" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        36. C√¥ng t√°c ch√≠nh ƒëang l√†m <span class="text-primary-red">*</span>
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="congTacChinhDangLam" name="congTacChinhDangLam" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        37. Ng·∫°ch c√¥ng ch·ª©c
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="ngachCongChuc" name="ngachCongChuc" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        38. B·∫≠c l∆∞∆°ng
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="bacLuong" name="bacLuong" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        39. H·ªá s·ªë
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="heSo" name="heSo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        40. T·ª´ th√°ng (MM/yyyy)
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="month" id="tuThang" name="tuThang" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">
                        41. S·ªü tr∆∞·ªùng c√¥ng t√°c
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="soTruongCongTac" name="soTruongCongTac" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700">
                        42. C√¥ng vi·ªác ƒë√£ l√†m l√¢u nh·∫•t
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="congViecLauNhat" name="congViecLauNhat" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">
                        43. ƒêi·ªán tho·∫°i
                        <span class="text-xs text-blue-600 ml-1">üìã HSNV</span>
                    </label>
                    <input type="text" id="dienThoai" name="dienThoai" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700">44. Danh hi·ªáu ƒë∆∞·ª£c phong t·∫∑ng cao nh·∫•t</label>
                    <input type="text" id="danhHieu" name="danhHieu" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                </div>

            </div>

            <div class="mt-8 pt-4 border-t flex justify-end space-x-3">
                <button type="button" onclick="closeModal('modalDataEntry')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">H·ªßy</button>
                <button type="submit" class="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 font-semibold transition duration-150 shadow-md">L∆∞u H·ªì s∆°</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal 3: T·∫°o m·ªõi L·ªõp Nh·∫≠n Th·ª©c -->
<div id="modalCreateClass" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay">
    <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-lg mx-auto transform transition-all duration-300 scale-95 opacity-0" id="modalCreateClassInner">
        <h3 class="text-2xl font-bold text-gray-800 border-b pb-3 mb-4">T·∫°o m·ªõi L·ªõp Nh·∫≠n Th·ª©c</h3>
        
        <form id="classForm" onsubmit="handleClassSubmit(event)">
            <div class="space-y-4">
                <!-- T√™n l·ªõp -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">1. T√™n l·ªõp <span class="text-primary-red">*</span></label>
                    <input type="text" id="className" name="className" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                <!-- NƒÉm t·ªï ch·ª©c -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">2. NƒÉm t·ªï ch·ª©c <span class="text-primary-red">*</span></label>
                    <select id="classYear" name="classYear" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                        <option value="">-- Ch·ªçn NƒÉm --</option>
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                        <option value="2023">2023</option>
                    </select>
                </div>
                <!-- Ng√†y b·∫Øt ƒë·∫ßu -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">3. Ng√†y b·∫Øt ƒë·∫ßu <span class="text-primary-red">*</span></label>
                    <input type="date" id="classStart" name="classStart" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                <!-- Ng√†y k·∫øt th√∫c -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">4. Ng√†y k·∫øt th√∫c <span class="text-primary-red">*</span></label>
                    <input type="date" id="classEnd" name="classEnd" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" required>
                </div>
                 <!-- Ghi ch√∫ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700">5. Ghi ch√∫</label>
                    <textarea id="classNote" name="classNote" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border"></textarea>
                </div>
            </div>

            <div class="mt-8 pt-4 border-t flex justify-end space-x-3">
                <button type="button" onclick="closeModal('modalCreateClass')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">H·ªßy</button>
                <button type="submit" class="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 font-semibold transition duration-150 shadow-md">L∆∞u L·ªõp</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal 4: Chi ti·∫øt L·ªõp Nh·∫≠n Th·ª©c & Qu·∫£n l√Ω H·ªçc vi√™n -->
<div id="modalClassDetail" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-6xl mx-auto transform transition-all duration-300 scale-95 opacity-0" id="modalClassDetailInner">
        <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
            <h3 class="text-2xl font-bold text-gray-800">Chi ti·∫øt L·ªõp: <span id="detailClassName" class="text-primary-red"></span></h3>
            <button onclick="closeModal('modalClassDetail')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="p-6">
            <!-- (A) Th√¥ng tin l·ªõp -->
            <div class="bg-gray-50 p-4 rounded-lg border mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="font-medium text-gray-700"><i class="fas fa-calendar-alt mr-2"></i>NƒÉm t·ªï ch·ª©c: <span id="detailClassYear" class="font-bold text-gray-900"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-clock mr-2"></i>Ng√†y Bƒê - KT: <span id="detailClassDates" class="font-bold text-gray-900"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-users mr-2"></i>Sƒ© s·ªë: <span id="detailClassSize" class="font-bold text-primary-red"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-check-double mr-2"></i>Ho√†n th√†nh: <span id="detailClassCompleted" class="font-bold text-green-600"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-info-circle mr-2"></i>Tr·∫°ng th√°i: <span id="detailClassStatus" class="font-bold"></span></div>
                <div class="font-medium text-gray-700 md:col-span-3"><i class="fas fa-pencil-alt mr-2"></i>Ghi ch√∫: <span id="detailClassNote" class="font-normal text-gray-600"></span></div>
            </div>

            <!-- (B) Danh s√°ch h·ªçc vi√™n -->
            <div class="flex justify-between items-center mb-4">
                <h4 class="text-xl font-semibold text-gray-800">Danh s√°ch H·ªçc vi√™n (<span id="currentClassSize">0</span>)</h4>
                <div>
                    <button onclick="openAddStudentModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition shadow-md mr-3">
                        <i class="fas fa-user-plus mr-2"></i> Th√™m H·ªçc vi√™n
                    </button>
                    <!-- FIX: ƒê·ªãnh nghƒ©a h√†m openClassStatusUpdateModal() -->
                    <button onclick="openClassStatusUpdateModal()" class="bg-primary-red text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition shadow-md">
                        <i class="fas fa-sync-alt mr-2"></i> C·∫≠p nh·∫≠t L·ªõp
                    </button>
                </div>
            </div>
            
            <div id="classStudentList" class="overflow-x-auto bg-white rounded-lg shadow border">
                <!-- Danh s√°ch h·ªçc vi√™n s·∫Ω ƒë∆∞·ª£c render t·∫°i ƒë√¢y -->
            </div>
        </div>
    </div>
</div>

<!-- Modal 5: Th√™m H·ªçc vi√™n v√†o L·ªõp (D√πng cho L·ªõp Nh·∫≠n th·ª©c) -->
<div id="modalAddStudent" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-2xl mx-auto p-6 transform transition-all duration-300 scale-95 opacity-0" id="modalAddStudentInner">
        <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">Th√™m H·ªçc vi√™n m·ªõi (T·ª´ Qu·∫ßn Ch√∫ng ∆Øu T√∫)</h3>
        <p class="text-sm text-gray-600 mb-4">Ch·ªâ hi·ªÉn th·ªã h·ªì s∆° **Qu·∫ßn Ch√∫ng ∆Øu T√∫** ƒë√£ chuy·ªÉn l√™n b∆∞·ªõc C·∫£m t√¨nh/Ch∆∞a g√°n l·ªõp.</p>
        
        <div id="availableStudentsList" class="space-y-3 h-80 overflow-y-auto border p-3 rounded-lg bg-gray-50">
            <!-- Danh s√°ch h·ªçc vi√™n kh·∫£ d·ª•ng ƒë∆∞·ª£c render b·∫±ng JS -->
        </div>

        <div class="mt-6 pt-4 border-t flex justify-end space-x-3">
            <button type="button" onclick="closeModal('modalAddStudent')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">H·ªßy</button>
            <button type="button" onclick="addSelectedStudents()" class="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 font-semibold transition duration-150 shadow-md">Th√™m (<span id="selectedCount">0</span>) H·ªì s∆°</button>
        </div>
    </div>
</div>


<!-- Modal 6: Th√™m Ng∆∞·ªùi H∆∞·ªõng D·∫´n (D√πng cho R√®n luy·ªán th·ª≠ th√°ch) -->
<div id="modalAddMentor" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-2xl mx-auto p-6 transform transition-all duration-300 scale-95 opacity-0" id="modalAddMentorInner">
        <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">Th√™m Ng∆∞·ªùi H∆∞·ªõng D·∫´n m·ªõi</h3>
        <p class="text-sm text-gray-600 mb-4">Vui l√≤ng ch·ªçn ƒê·ªìng ch√≠ ƒê·∫£ng vi√™n s·∫Ω tham gia h∆∞·ªõng d·∫´n r√®n luy·ªán.</p>
        
        <div id="availableMentorList" class="space-y-3 h-80 overflow-y-auto border p-3 rounded-lg bg-gray-50">
            <!-- Danh s√°ch ƒê·∫£ng vi√™n kh·∫£ d·ª•ng ƒë∆∞·ª£c render b·∫±ng JS -->
        </div>

        <div class="mt-6 pt-4 border-t flex justify-end space-x-3">
            <button type="button" onclick="closeModal('modalAddMentor')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">H·ªßy</button>
            <button type="button" onclick="addSelectedMentors()" class="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 font-semibold transition duration-150 shadow-md">Th√™m (<span id="selectedMentorCount">0</span>) ƒê·ªìng ch√≠</button>
        </div>
    </div>
</div>

<!-- Modal 7: Chi ti·∫øt Ng∆∞·ªùi H∆∞·ªõng D·∫´n & Qu·∫£n l√Ω H·ªçc vi√™n r√®n luy·ªán -->
<div id="modalMentorDetail" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-6xl mx-auto transform transition-all duration-300 scale-95 opacity-0" id="modalMentorDetailInner">
        <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
            <h3 class="text-2xl font-bold text-gray-800">Chi ti·∫øt Ng∆∞·ªùi H∆∞·ªõng D·∫´n: <span id="detailMentorName" class="text-primary-red"></span></h3>
            <button onclick="closeModal('modalMentorDetail')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="p-6">
            <!-- (A) Th√¥ng tin Ng∆∞·ªùi H∆∞·ªõng D·∫´n -->
            <div class="bg-gray-50 p-4 rounded-lg border mb-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="font-medium text-gray-700"><i class="fas fa-id-card mr-2"></i>M√£ ƒê·∫£ng vi√™n: <span id="detailMentorCode" class="font-bold text-gray-900"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-user-tag mr-2"></i>Ch·ª©c danh: <span id="detailMentorTitle" class="font-bold text-gray-900"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-users-cog mr-2"></i>B·ªô ph·∫≠n: <span id="detailMentorDept" class="font-bold text-primary-red"></span></div>
                <div class="font-medium text-gray-700 md:col-span-3"><i class="fas fa-hashtag mr-2"></i>S·ªë h·ªì s∆° ƒëang h∆∞·ªõng d·∫´n: <span id="detailMentorStudentCount" class="font-bold text-green-600"></span></div>
            </div>

            <!-- (B) Danh s√°ch H·ªì s∆° ƒëang r√®n luy·ªán -->
            <div class="flex justify-between items-center mb-4">
                <h4 class="text-xl font-semibold text-gray-800">Danh s√°ch H·ªì s∆° ƒëang H∆∞·ªõng d·∫´n (<span id="currentMentorStudentCount">0</span>)</h4>
                <div>
                    <button onclick="openAssignStudentModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition shadow-md mr-3">
                        <i class="fas fa-user-plus mr-2"></i> G√°n H·ªì s∆°
                    </button>
                    <button onclick="alert('Ch·ª©c nƒÉng C·∫≠p nh·∫≠t tr·∫°ng th√°i h√†ng lo·∫°t ƒëang ƒë∆∞·ª£c tri·ªÉn khai.')" class="bg-primary-red text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition shadow-md">
                        <i class="fas fa-sync-alt mr-2"></i> C·∫≠p nh·∫≠t Tr·∫°ng th√°i
                    </button>
                </div>
            </div>
            
            <div id="mentorStudentList" class="overflow-x-auto bg-white rounded-lg shadow border">
                <!-- Danh s√°ch h·ªçc vi√™n s·∫Ω ƒë∆∞·ª£c render t·∫°i ƒë√¢y -->
            </div>
        </div>
    </div>
</div>

<!-- Modal 8: G√°n H·ªì s∆° v√†o Ng∆∞·ªùi H∆∞·ªõng D·∫´n -->
<div id="modalAssignStudents" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-2xl mx-auto p-6 transform transition-all duration-300 scale-95 opacity-0" id="modalAssignStudentsInner">
        <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">Ch·ªçn H·ªì s∆° g√°n cho Ng∆∞·ªùi H∆∞·ªõng D·∫´n</h3>
        <p class="text-sm text-gray-600 mb-4">Ch·ªâ hi·ªÉn th·ªã h·ªì s∆° ƒë√£ **Ho√†n th√†nh L·ªõp Nh·∫≠n th·ª©c** v√† **Ch∆∞a c√≥ Ng∆∞·ªùi H∆∞·ªõng D·∫´n**.</p>
        
        <div id="assignableStudentsList" class="space-y-3 h-80 overflow-y-auto border p-3 rounded-lg bg-gray-50">
            <!-- Danh s√°ch h·ªçc vi√™n kh·∫£ d·ª•ng ƒë∆∞·ª£c render b·∫±ng JS -->
        </div>

        <div class="mt-6 pt-4 border-t flex justify-end space-x-3">
            <button type="button" onclick="closeModal('modalAssignStudents')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">H·ªßy</button>
            <button type="button" onclick="assignSelectedStudentsToMentor()" class="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 font-semibold transition duration-150 shadow-md">G√°n (<span id="assignSelectedCount">0</span>) H·ªì s∆°</button>
        </div>
    </div>
</div>

<!-- Modal 9: Chi ti·∫øt T√†i li·ªáu c·ªßa 1 H·ªì s∆° (Ho√†n thi·ªán h·ªì s∆°) -->
<div id="modalDocumentDetail" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-3xl mx-auto transform transition-all duration-300 scale-95 opacity-0" id="modalDocumentDetailInner">
        <div class="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-10">
            <h3 class="text-2xl font-bold text-gray-800">Chi ti·∫øt T√†i li·ªáu: <span id="docDetailName" class="text-primary-red"></span></h3>
            <button onclick="closeModal('modalDocumentDetail')" class="text-gray-500 hover:text-gray-700">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div class="p-6">
            <!-- Th√¥ng tin c∆° b·∫£n -->
            <div class="bg-gray-50 p-4 rounded-lg border mb-6 grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                <div class="font-medium text-gray-700"><i class="fas fa-user mr-2"></i>Ch·ª©c danh: <span id="docDetailTitle" class="font-bold text-gray-900"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-building mr-2"></i>ƒê∆°n v·ªã: <span id="docDetailUnit" class="font-bold text-gray-900"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-user-tie mr-2"></i>Ng∆∞·ªùi h∆∞·ªõng d·∫´n: <span id="docDetailMentor" class="font-bold text-gray-900"></span></div>
                <div class="font-medium text-gray-700"><i class="fas fa-chart-pie mr-2"></i>Ti·∫øn ƒë·ªô: <span id="docDetailProgress" class="font-bold text-primary-red"></span></div>
            </div>

            <!-- Checklist 6 t√†i li·ªáu -->
            <h4 class="text-lg font-semibold text-gray-800 mb-4">Checklist T√†i li·ªáu c·∫ßn n·ªôp</h4>
            <div id="documentChecklistTable" class="overflow-x-auto bg-white rounded-lg shadow border">
                <!-- Table s·∫Ω ƒë∆∞·ª£c render b·∫±ng JS -->
            </div>
        </div>

        <div class="p-6 pt-4 border-t flex justify-end">
            <button onclick="closeModal('modalDocumentDetail')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">ƒê√≥ng</button>
        </div>
    </div>
</div>

<!-- Modal 10: C·∫≠p nh·∫≠t H√†ng lo·∫°t T√†i li·ªáu -->
<div id="modalBulkUpdate" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-3xl mx-auto p-6 transform transition-all duration-300 scale-95 opacity-0" id="modalBulkUpdateInner">
        <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">C·∫≠p nh·∫≠t H√†ng lo·∫°t T√†i li·ªáu</h3>
        
        <form id="bulkUpdateForm" onsubmit="handleBulkUpdate(event)">
            <!-- 1. Ch·ªçn h·ªì s∆° -->
            <div class="mb-6">
                <h4 class="text-md font-semibold text-gray-700 mb-3">1. Ch·ªçn h·ªì s∆° c·∫ßn c·∫≠p nh·∫≠t:</h4>
                <div id="bulkProfileList" class="space-y-2 max-h-60 overflow-y-auto border p-3 rounded-lg bg-gray-50">
                    <!-- Danh s√°ch checkbox h·ªì s∆° ƒë∆∞·ª£c render b·∫±ng JS -->
                </div>
                <p class="text-xs text-gray-500 mt-2">ƒê√£ ch·ªçn: <span id="bulkSelectedProfileCount" class="font-bold text-primary-red">0</span> h·ªì s∆°</p>
            </div>

            <!-- 2. Ch·ªçn lo·∫°i t√†i li·ªáu -->
            <div class="mb-6">
                <h4 class="text-md font-semibold text-gray-700 mb-3">2. Ch·ªçn lo·∫°i t√†i li·ªáu mu·ªën c·∫≠p nh·∫≠t:</h4>
                <div id="bulkDocumentList" class="space-y-2 border p-3 rounded-lg bg-gray-50">
                    <!-- Danh s√°ch checkbox 6 t√†i li·ªáu ƒë∆∞·ª£c render b·∫±ng JS -->
                </div>
                <p class="text-xs text-gray-500 mt-2">ƒê√£ ch·ªçn: <span id="bulkSelectedDocCount" class="font-bold text-primary-red">0</span> lo·∫°i t√†i li·ªáu</p>
            </div>

            <!-- 3. Ch·ªçn tr·∫°ng th√°i √°p d·ª•ng -->
            <div class="mb-6">
                <h4 class="text-md font-semibold text-gray-700 mb-3">3. Tr·∫°ng th√°i mu·ªën √°p d·ª•ng:</h4>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="radio" name="bulkStatus" value="true" class="form-radio text-primary-red h-4 w-4 mr-2" required>
                        <span class="text-sm text-gray-700">ƒê√°nh d·∫•u t·∫•t c·∫£ l√† <strong class="text-green-600">ƒê√£ n·ªôp</strong></span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="bulkStatus" value="false" class="form-radio text-primary-red h-4 w-4 mr-2">
                        <span class="text-sm text-gray-700">ƒê√°nh d·∫•u t·∫•t c·∫£ l√† <strong class="text-red-600">Ch∆∞a n·ªôp</strong></span>
                    </label>
                </div>
            </div>

            <div class="pt-4 border-t flex justify-end space-x-3">
                <button type="button" onclick="closeModal('modalBulkUpdate')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">H·ªßy</button>
                <button type="submit" class="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 font-semibold transition duration-150 shadow-md">
                    <i class="fas fa-save mr-2"></i>L∆∞u C·∫≠p nh·∫≠t
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal 11: C·∫≠p nh·∫≠t H√†ng lo·∫°t Tr·∫°ng th√°i K·∫øt n·∫°p -->
<div id="modalBulkAdmission" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay overflow-y-auto">
    <div class="bg-white rounded-xl shadow-2xl my-10 w-full max-w-3xl mx-auto p-6 transform transition-all duration-300 scale-95 opacity-0" id="modalBulkAdmissionInner">
        <h3 class="text-xl font-bold text-gray-800 border-b pb-3 mb-4">C·∫≠p nh·∫≠t H√†ng lo·∫°t Tr·∫°ng th√°i K·∫øt n·∫°p</h3>
        
        <form id="bulkAdmissionForm" onsubmit="handleBulkAdmission(event)">
            <!-- 1. Ch·ªçn h·ªì s∆° -->
            <div class="mb-6">
                <h4 class="text-md font-semibold text-gray-700 mb-3">1. Ch·ªçn h·ªì s∆° c·∫ßn c·∫≠p nh·∫≠t:</h4>
                <div id="bulkAdmissionProfileList" class="space-y-2 max-h-80 overflow-y-auto border p-3 rounded-lg bg-gray-50">
                    <!-- Danh s√°ch checkbox h·ªì s∆° ƒë∆∞·ª£c render b·∫±ng JS -->
                </div>
                <p class="text-xs text-gray-500 mt-2">ƒê√£ ch·ªçn: <span id="bulkAdmissionSelectedCount" class="font-bold text-primary-red">0</span> h·ªì s∆°</p>
            </div>

            <!-- 2. Ch·ªçn tr·∫°ng th√°i k·∫øt n·∫°p -->
            <div class="mb-6">
                <h4 class="text-md font-semibold text-gray-700 mb-3">2. Tr·∫°ng th√°i k·∫øt n·∫°p mu·ªën √°p d·ª•ng:</h4>
                <div class="space-y-2">
                    <label class="flex items-center p-3 bg-yellow-50 rounded-lg border border-yellow-200 hover:bg-yellow-100 cursor-pointer">
                        <input type="radio" name="bulkAdmissionStatus" value="ƒêang th·ª±c hi·ªán" class="form-radio text-primary-red h-4 w-4 mr-3" required>
                        <div>
                            <span class="text-sm font-semibold text-gray-700">ƒêang th·ª±c hi·ªán</span>
                            <p class="text-xs text-gray-500">H·ªì s∆° ƒëang trong qu√° tr√¨nh x·ª≠ l√Ω k·∫øt n·∫°p</p>
                        </div>
                    </label>
                    <label class="flex items-center p-3 bg-red-50 rounded-lg border border-red-200 hover:bg-red-100 cursor-pointer">
                        <input type="radio" name="bulkAdmissionStatus" value="Kh√¥ng ho√†n th√†nh" class="form-radio text-primary-red h-4 w-4 mr-3">
                        <div>
                            <span class="text-sm font-semibold text-gray-700">Kh√¥ng ho√†n th√†nh</span>
                            <p class="text-xs text-gray-500">H·ªì s∆° kh√¥ng ƒë·∫°t y√™u c·∫ßu k·∫øt n·∫°p</p>
                        </div>
                    </label>
                    <label class="flex items-center p-3 bg-green-50 rounded-lg border border-green-200 hover:bg-green-100 cursor-pointer">
                        <input type="radio" name="bulkAdmissionStatus" value="Ho√†n th√†nh" class="form-radio text-primary-red h-4 w-4 mr-3">
                        <div>
                            <span class="text-sm font-semibold text-green-700">Ho√†n th√†nh</span>
                            <p class="text-xs text-green-600 font-medium">‚ö†Ô∏è H·ªì s∆° s·∫Ω t·ª± ƒë·ªông chuy·ªÉn sang ph√¢n h·ªá ƒê·∫£ng vi√™n v·ªõi ch·ª©c danh "ƒê·∫£ng vi√™n d·ª± b·ªã"</p>
                        </div>
                    </label>
                </div>
            </div>

            <div class="pt-4 border-t flex justify-end space-x-3">
                <button type="button" onclick="closeModal('modalBulkAdmission')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 font-semibold transition duration-150">H·ªßy</button>
                <button type="submit" class="px-4 py-2 bg-primary-red text-white rounded-lg hover:bg-red-700 font-semibold transition duration-150 shadow-md">
                    <i class="fas fa-save mr-2"></i>L∆∞u C·∫≠p nh·∫≠t
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Slide-in Panel: Xem chi ti·∫øt H·ªì s∆° QCUT (ƒê√£ c√≥ t·ª´ tr∆∞·ªõc) -->
<div id="slideInDetailView" class="fixed top-0 right-0 h-full w-full md:w-1/3 bg-white z-50 shadow-2xl overflow-y-auto slide-in-panel">
    <div class="p-6 sticky top-0 bg-white border-b flex justify-between items-center z-10">
        <h3 class="text-xl font-bold text-gray-800">Chi ti·∫øt H·ªì s∆°: <span id="detailName" class="text-primary-red"></span></h3>
        <button onclick="closeSlideIn()" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times text-xl"></i>
        </button>
    </div>
    
    <!-- Tab Navigation trong Slide-in -->
    <div class="flex border-b text-sm font-medium text-gray-500">
        <button id="tabThongTin" class="p-3 border-b-2 border-primary-red text-primary-red tab-button flex-1" data-tab="thong-tin">
            <i class="fas fa-info-circle mr-1"></i> 1. Th√¥ng tin C√° nh√¢n
        </button>
        <button id="tabTienDo" class="p-3 border-b-2 border-transparent hover:border-gray-300 tab-button flex-1" data-tab="tien-do">
            <i class="fas fa-chart-line mr-1"></i> 2. Ti·∫øn ƒë·ªô 5 b∆∞·ªõc
        </button>
    </div>

    <!-- N·ªôi dung Tab 1: Th√¥ng tin C√° nh√¢n (Read-only) -->
    <div id="contentThongTin" class="p-6 space-y-4">
        <h4 class="font-semibold text-lg text-gray-700 border-b pb-2">Th√¥ng tin C∆° b·∫£n</h4>
        <div id="detailInfoContent" class="grid grid-cols-2 gap-4 text-sm">
            <!-- N·ªôi dung chi ti·∫øt ƒë∆∞·ª£c render b·∫±ng JS -->
        </div>
    </div>

    <!-- N·ªôi dung Tab 2: Ti·∫øn ƒë·ªô 5 b∆∞·ªõc (Timeline) -->
    <div id="contentTienDo" class="p-6 hidden">
        <h4 class="font-semibold text-lg text-gray-700 mb-4">Ti·∫øn ƒë·ªô Ph√°t tri·ªÉn</h4>
        <div id="progressTimeline" class="space-y-6">
            <!-- D·ªØ li·ªáu Timeline ƒë∆∞·ª£c render b·∫±ng JS -->
        </div>
    </div>
</div>


<!-- --- JAVASCRIPT LOGIC --- -->
<script>
    // Constants for Step Names
    const STEPS = {
        QUAN_CHUNG: "Qu·∫ßn ch√∫ng ∆∞u t√∫",
        CAM_TINH: "C·∫£m t√¨nh ƒê·∫£ng",
        LOP_NHAN_THUC: "L·ªõp Nh·∫≠n th·ª©c",
        REN_LUYEN: "R√®n luy·ªán th·ª≠ th√°ch",
        HOAN_THIEN: "Ho√†n thi·ªán H·ªì s∆°", // Th√™m b∆∞·ªõc m·ªõi
        KET_NAP: "K·∫øt n·∫°p ƒê·∫£ng",
        CHINH_THUC: "ƒê·∫£ng vi√™n ch√≠nh th·ª©c"
    };

    // Danh s√°ch 6 lo·∫°i t√†i li·ªáu b·∫Øt bu·ªôc
    const REQUIRED_DOCUMENTS = [
        { id: 1, name: "Gi·∫•y ch·ª©ng nh·∫≠n h·ªçc l·ªõp b·ªìi d∆∞·ª°ng nh·∫≠n th·ª©c v·ªÅ ƒê·∫£ng" },
        { id: 2, name: "ƒê∆°n xin v√†o ƒê·∫£ng" },
        { id: 3, name: "L√Ω l·ªãch c·ªßa ng∆∞·ªùi xin v√†o ƒê·∫£ng v√† c√°c vƒÉn b·∫£n th·∫©m tra k√®m theo" },
        { id: 4, name: "Gi·∫•y gi·ªõi thi·ªáu c·ªßa ƒë·∫£ng vi√™n ch√≠nh th·ª©c ƒë∆∞·ª£c ph√¢n c√¥ng gi√∫p ƒë·ª°" },
        { id: 5, name: "Ngh·ªã quy·∫øt gi·ªõi thi·ªáu ƒëo√†n vi√™n ∆∞u t√∫ v√†o ƒê·∫£ng c·ªßa ƒêo√†n Thanh ni√™n C·ªông s·∫£n H·ªì Ch√≠ Minh ho·∫∑c c·ªßa c√¥ng ƒëo√†n c∆° s·ªü" },
        { id: 6, name: "T·ªïng h·ª£p √Ω ki·∫øn nh·∫≠n x√©t c·ªßa ƒëo√†n th·ªÉ ch√≠nh tr·ªã - x√£ h·ªôi n∆°i ng∆∞·ªùi v√†o ƒê·∫£ng sinh ho·∫°t v√† chi ·ªßy (ho·∫∑c chi b·ªô) n∆°i c∆∞ tr√∫ ƒë·ªëi v·ªõi ng∆∞·ªùi v√†o ƒê·∫£ng" }
    ];

    // Mock Data Store
    let mockData = [
        { id: 1, hoTen: "Nguy·ªÖn VƒÉn A", maNV: "NV001", gioiTinh: "Nam", donVi: "Chi b·ªô Ph√≤ng K·∫ø to√°n", chucDanh: "Chuy√™n vi√™n", ngayTiepNhan: "2024-05-15", ngaySinh: "1990-01-01", cccd: "001190000123", diaChiThuongTru: "123 Gi·∫£i Ph√≥ng", trangThai: STEPS.HOAN_THIEN, currentStepIndex: 4, classId: 102, classEntryDate: "01/03/2023", classStatus: "Ho√†n th√†nh", mentorId: 201, trainingStatus: "Ho√†n th√†nh", trainingStartDate: "2024-09-01", 
            documents: { 1: true, 2: true, 3: false, 4: true, 5: false, 6: true }, // Tr·∫°ng th√°i 6 t√†i li·ªáu
            progress: [
            { step: STEPS.QUAN_CHUNG, status: "Ho√†n th√†nh", start: "15/05/2024", end: "10/06/2024", note: "Ho√†n th√†nh giai ƒëo·∫°n quan s√°t." },
            { step: STEPS.CAM_TINH, status: "Ho√†n th√†nh", start: "11/06/2024", end: "20/08/2024", note: "Ch√≠nh th·ª©c tr·ªü th√†nh c·∫£m t√¨nh ƒê·∫£ng." },
            { step: STEPS.LOP_NHAN_THUC, status: "Ho√†n th√†nh", start: "01/03/2023", end: "01/04/2023", note: "Ho√†n th√†nh L·ªõp Nh·∫≠n th·ª©c 2023-K1" },
            { step: STEPS.REN_LUYEN, status: "Ho√†n th√†nh", start: "01/09/2024", end: "15/10/2024", note: "Ho√†n th√†nh r√®n luy·ªán v·ªõi ƒê/c X." },
            { step: STEPS.HOAN_THIEN, status: "ƒêang th·ª±c hi·ªán", start: "16/10/2024", end: "N/A", note: "ƒêang ho√†n thi·ªán h·ªì s∆° (4/6 t√†i li·ªáu)" },
            { step: STEPS.KET_NAP, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
            { step: STEPS.CHINH_THUC, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
        ]},
        { id: 2, hoTen: "L√™ Th·ªã B", maNV: "NV002", gioiTinh: "N·ªØ", donVi: "Chi b·ªô Ban L√£nh ƒë·∫°o", chucDanh: "Ph√≥ Gi√°m ƒë·ªëc", ngayTiepNhan: "2024-06-01", ngaySinh: "1995-10-12", cccd: "002195000456", diaChiThuongTru: "456 B√† Tri·ªáu", trangThai: STEPS.KET_NAP, currentStepIndex: 5, classId: 101, classEntryDate: "05/09/2024", classStatus: "Ho√†n th√†nh", mentorId: 202, trainingStatus: "Ho√†n th√†nh", trainingStartDate: "2024-10-06",
            documents: { 1: true, 2: true, 3: true, 4: true, 5: true, 6: true }, // ƒê·ªß 6/6 t√†i li·ªáu
            ketNapStatus: "ƒêang th·ª±c hi·ªán", // Tr·∫°ng th√°i k·∫øt n·∫°p
            ketNapCompletedDate: null, // Ng√†y ho√†n th√†nh b∆∞·ªõc Ho√†n thi·ªán h·ªì s∆°
            progress: [
            { step: STEPS.QUAN_CHUNG, status: "Ho√†n th√†nh", start: "01/06/2024", end: "01/09/2024", note: "" },
            { step: STEPS.CAM_TINH, status: "Ho√†n th√†nh", start: "02/09/2024", end: "04/09/2024", note: "" },
            { step: STEPS.LOP_NHAN_THUC, status: "Ho√†n th√†nh", start: "05/09/2024", end: "05/10/2024", note: "Tham gia L·ªõp Nh·∫≠n th·ª©c 2024-K2" },
            { step: STEPS.REN_LUYEN, status: "Ho√†n th√†nh", start: "06/10/2024", end: "01/11/2024", note: "Ho√†n th√†nh r√®n luy·ªán" },
            { step: STEPS.HOAN_THIEN, status: "Ho√†n th√†nh", start: "02/11/2024", end: "09/11/2024", note: "ƒê√£ n·ªôp ƒë·ªß 6/6 t√†i li·ªáu" },
            { step: STEPS.KET_NAP, status: "ƒêang th·ª±c hi·ªán", start: "10/11/2024", end: "N/A", note: "ƒê√£ chuy·ªÉn sang Quy·∫øt ƒë·ªãnh k·∫øt n·∫°p" },
            { step: STEPS.CHINH_THUC, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
            { step: STEPS.CHINH_THUC, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
        ]},
        { id: 3, hoTen: "Tr·∫ßn VƒÉn C", maNV: "NV003", gioiTinh: "Nam", donVi: "Chi b·ªô Ph√≤ng K·∫ø to√°n", chucDanh: "K·∫ø to√°n vi√™n", ngayTiepNhan: "2024-07-01", ngaySinh: "1992-03-20", cccd: "003192000789", diaChiThuongTru: "789 Nguy·ªÖn Ch√≠ Thanh", trangThai: STEPS.REN_LUYEN, currentStepIndex: 3, classId: 101, classEntryDate: "05/09/2024", classStatus: "Ho√†n th√†nh", mentorId: 202, trainingStatus: "ƒêang r√®n luy·ªán", trainingStartDate: "2024-10-06",
            documents: { 1: false, 2: false, 3: false, 4: false, 5: false, 6: false }, // Ch∆∞a c√≥ t√†i li·ªáu n√†o
            progress: [
            { step: STEPS.QUAN_CHUNG, status: "Ho√†n th√†nh", start: "01/07/2024", end: "01/09/2024", note: "Ho√†n th√†nh giai ƒëo·∫°n quan s√°t." },
            { step: STEPS.CAM_TINH, status: "Ho√†n th√†nh", start: "02/09/2024", end: "04/09/2024", note: "Ch√≠nh th·ª©c tr·ªü th√†nh c·∫£m t√¨nh ƒê·∫£ng." },
            { step: STEPS.LOP_NHAN_THUC, status: "Ho√†n th√†nh", start: "05/09/2024", end: "05/10/2024", note: "Tham gia L·ªõp Nh·∫≠n th·ª©c 2024-K2" },
            { step: STEPS.REN_LUYEN, status: "ƒêang th·ª±c hi·ªán", start: "06/10/2024", end: "N/A", note: "ƒêang r√®n luy·ªán v·ªõi ƒê/c Y" },
            { step: STEPS.HOAN_THIEN, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
            { step: STEPS.KET_NAP, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
            { step: STEPS.CHINH_THUC, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
        ]},
    ];
    
    let mockClasses = [
        { id: 101, name: "L·ªõp Nh·∫≠n th·ª©c 2024-K2", year: 2024, start: "2024-09-05", end: "2024-10-05", status: "Ho√†n th√†nh", note: "L·ªõp online.", students: [2, 3] }, // Updated: Finished
        { id: 102, name: "L·ªõp Nh·∫≠n th·ª©c 2023-K1", year: 2023, start: "2023-03-01", end: "2023-04-01", status: "Ho√†n th√†nh", note: "Ho√†n th√†nh 100%." , students: [1] }, // Updated: Finished
    ];
    let currentClassId = null; // Bi·∫øn l∆∞u Class ID ƒëang m·ªü

    let mockMentors = [
        // isAssigned: true nghƒ©a l√† ƒë√£ ƒë∆∞·ª£c th√™m v√†o danh s√°ch qu·∫£n l√Ω Ng∆∞·ªùi h∆∞·ªõng d·∫´n
        { id: 201, hoTen: "ƒê·ªìng ch√≠ X", maDV: "DV001", chucDanh: "B√≠ th∆∞ Chi b·ªô", boPhan: "Chi b·ªô Ph√≤ng K·∫ø to√°n", isAssigned: true },
        { id: 202, hoTen: "ƒê·ªìng ch√≠ Y", maDV: "DV002", chucDanh: "Ph√≥ B√≠ th∆∞", boPhan: "Chi b·ªô Ban L√£nh ƒë·∫°o", isAssigned: true },
        { id: 203, hoTen: "ƒê·ªìng ch√≠ Z", maDV: "DV003", chucDanh: "ƒê·∫£ng vi√™n", boPhan: "Chi b·ªô Ph√≤ng K·∫ø to√°n", isAssigned: false },
    ];
    let currentMentorId = null; // Bi·∫øn l∆∞u Mentor ID ƒëang m·ªü
    let currentDocProfileId = null; // Bi·∫øn l∆∞u Profile ID ƒëang xem chi ti·∫øt t√†i li·ªáu
    
    // Mock Data: H·ªì s∆° ƒê·∫£ng vi√™n (Ph√¢n h·ªá m·ªõi)
    let mockPartyMembers = [
        // H·ªì s∆° ƒë·∫£ng vi√™n s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông khi ho√†n th√†nh Quy·∫øt ƒë·ªãnh k·∫øt n·∫°p
    ];
    
    // Mock Data: H·ªì s∆° Nh√¢n vi√™n (HSNV)
    let mockEmployees = [
        { id: 1, hoTen: "Ph·∫°m VƒÉn D", maNV: "NV004", gioiTinh: "Nam", ngaySinh: "1988-05-15", cccd: "004188001234", donVi: "Ph√≤ng K·∫ø to√°n", chucDanh: "K·∫ø to√°n tr∆∞·ªüng", boPhanCongTac: "Ph√≤ng K·∫ø to√°n", congTacChinhDangLam: "Qu·∫£n l√Ω t√†i ch√≠nh", diaChiThuongTru: "100 Tr·∫ßn H∆∞ng ƒê·∫°o, H√† N·ªôi", dienThoai: "0912345678", danToc: "Kinh", tonGiao: "Kh√¥ng", noiSinhTP: "H√† N·ªôi", noiSinhPhuong: "Ph∆∞·ªùng ƒê·ªëng ƒêa", queQuanTP: "H√† N·ªôi", queQuanPhuong: "X√£ ƒê√¥ng Anh", thuongTruTP: "H√† N·ªôi", ngayTiepNhan: "2024-01-15" },
        { id: 2, hoTen: "Nguy·ªÖn Th·ªã E", maNV: "NV005", gioiTinh: "N·ªØ", ngaySinh: "1992-08-20", cccd: "005192002345", donVi: "Ban L√£nh ƒë·∫°o", chucDanh: "Tr·ª£ l√Ω Gi√°m ƒë·ªëc", boPhanCongTac: "Ban L√£nh ƒë·∫°o", congTacChinhDangLam: "H·ªó tr·ª£ ƒëi·ªÅu h√†nh", diaChiThuongTru: "200 Nguy·ªÖn Tr√£i, H√† N·ªôi", dienThoai: "0923456789", danToc: "Kinh", tonGiao: "Ph·∫≠t gi√°o", noiSinhTP: "H·ªì Ch√≠ Minh", noiSinhPhuong: "Ph∆∞·ªùng 1", queQuanTP: "H·ªì Ch√≠ Minh", queQuanPhuong: "Ph∆∞·ªùng 2", thuongTruTP: "H√† N·ªôi", ngayTiepNhan: "2024-02-10" },
        { id: 3, hoTen: "L√™ VƒÉn F", maNV: "NV006", gioiTinh: "Nam", ngaySinh: "1990-11-30", cccd: "006190003456", donVi: "Ph√≤ng H√†nh ch√≠nh", chucDanh: "Chuy√™n vi√™n HC", boPhanCongTac: "Ph√≤ng H√†nh ch√≠nh", congTacChinhDangLam: "Qu·∫£n l√Ω h·ªì s∆°", diaChiThuongTru: "300 L√°ng H·∫°, H√† N·ªôi", dienThoai: "0934567890", danToc: "Kinh", tonGiao: "Kh√¥ng", noiSinhTP: "ƒê√† N·∫µng", noiSinhPhuong: "Ph∆∞·ªùng H·∫£i Ch√¢u", queQuanTP: "ƒê√† N·∫µng", queQuanPhuong: "Ph∆∞·ªùng Thanh Kh√™", thuongTruTP: "H√† N·ªôi", ngayTiepNhan: "2024-03-05" },
    ];
    
    document.addEventListener('DOMContentLoaded', () => {
        const navSteps = document.querySelectorAll('.nav-step');
        const mainContent = document.getElementById('mainContent');
        const slideInDetailView = document.getElementById('slideInDetailView');
        
        // --- AUTH & FIREBASE INITIALIZATION ---
        // Trong m√¥i tr∆∞·ªùng th·ª±c, c·∫ßn kh·ªüi t·∫°o Firebase v√† x·ª≠ l√Ω Auth ·ªü ƒë√¢y

        // --- GLOBAL UTILITIES (Modal/Slide-in) ---
        window.openModal = (modalId) => {
            const modal = document.getElementById(modalId);
            const inner = document.getElementById(modalId + 'Inner'); // D√πng ID + 'Inner' l√†m m·∫∑c ƒë·ªãnh
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                setTimeout(() => {
                    if (inner) inner.classList.remove('scale-95', 'opacity-0');
                    if (inner) inner.classList.add('scale-100', 'opacity-100');
                }, 10);
            }
        };

        window.closeModal = (modalId) => {
            const modal = document.getElementById(modalId);
            const inner = document.getElementById(modalId + 'Inner');
            if (modal) {
                if (inner) inner.classList.remove('scale-100', 'opacity-100');
                if (inner) inner.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    modal.classList.remove('flex');
                    modal.classList.add('hidden');
                }, 300);
            }
        };
        
        window.openSlideIn = (recordId) => {
            const record = mockData.find(d => d.id === recordId);
            if (!record) return;

            document.getElementById('detailName').textContent = record.hoTen;
            renderDetailTabs(record);
            slideInDetailView.classList.add('open');
        };

        window.closeSlideIn = () => {
            slideInDetailView.classList.remove('open');
        };

        // H√†m m·ªü modal ch·ªçn t·ª´ HSNV
        window.openSelectHSNVModal = () => {
            closeModal('modalAddNewOption');
            renderHSNVList();
            openModal('modalSelectHSNV');
        };

        // Render danh s√°ch HSNV
        window.renderHSNVList = () => {
            const rows = mockEmployees.map(emp => `
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="selectFromHSNV(${emp.id})">
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap font-medium">${emp.hoTen}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${emp.maNV}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${emp.donVi}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${emp.chucDanh}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${emp.gioiTinh}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${new Date(emp.ngaySinh).toLocaleDateString('vi-VN')}</td>
                    <td class="p-3 text-sm text-center">
                        <button onclick="event.stopPropagation(); selectFromHSNV(${emp.id})" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs">
                            <i class="fas fa-check mr-1"></i>Ch·ªçn
                        </button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('hsnvListContainer').innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">H·ªç v√† t√™n</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">M√£ NV</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">ƒê∆°n v·ªã</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ch·ª©c danh</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Gi·ªõi t√≠nh</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y sinh</th>
                            <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${rows}
                    </tbody>
                </table>
            `;
        };

        // L·ªçc danh s√°ch HSNV
        window.filterHSNVList = () => {
            const nameFilter = document.getElementById('filterHSNVName').value.toLowerCase();
            const codeFilter = document.getElementById('filterHSNVCode').value.toLowerCase();
            const unitFilter = document.getElementById('filterHSNVUnit').value;

            const filtered = mockEmployees.filter(emp => {
                const matchName = emp.hoTen.toLowerCase().includes(nameFilter);
                const matchCode = emp.maNV.toLowerCase().includes(codeFilter);
                const matchUnit = !unitFilter || emp.donVi.includes(unitFilter);
                return matchName && matchCode && matchUnit;
            });

            const rows = filtered.map(emp => `
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="selectFromHSNV(${emp.id})">
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap font-medium">${emp.hoTen}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${emp.maNV}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${emp.donVi}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${emp.chucDanh}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${emp.gioiTinh}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${new Date(emp.ngaySinh).toLocaleDateString('vi-VN')}</td>
                    <td class="p-3 text-sm text-center">
                        <button onclick="event.stopPropagation(); selectFromHSNV(${emp.id})" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-xs">
                            <i class="fas fa-check mr-1"></i>Ch·ªçn
                        </button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('hsnvListContainer').querySelector('tbody').innerHTML = 
                rows || '<tr><td colspan="7" class="p-4 text-center text-gray-500">Kh√¥ng t√¨m th·∫•y nh√¢n vi√™n n√†o.</td></tr>';
        };

        // Ch·ªçn nh√¢n vi√™n t·ª´ HSNV v√† fill v√†o form
        window.selectFromHSNV = (empId) => {
            const emp = mockEmployees.find(e => e.id === empId);
            if (!emp) return;

            closeModal('modalSelectHSNV');
            
            // Reset form
            document.getElementById('qcRecordId').value = '';
            document.getElementById('qcForm').reset();
            document.getElementById('fromHSNV').value = 'true';

            // Auto-fill c√°c tr∆∞·ªùng t·ª´ HSNV (ƒë√°nh d·∫•u üìã HSNV)
            document.getElementById('hoTen').value = emp.hoTen;
            document.getElementById('maNV').value = emp.maNV;
            document.getElementById('maNV').required = true; // B·∫Øt bu·ªôc khi ch·ªçn t·ª´ HSNV
            document.getElementById('donVi').value = `Chi b·ªô ${emp.donVi}`;
            updateChiBoCha(); // C·∫≠p nh·∫≠t chi b·ªô cha
            document.getElementById('chucDanh').value = emp.chucDanh;
            document.getElementById('gioiTinh').value = emp.gioiTinh;
            document.getElementById('ngaySinh').value = emp.ngaySinh;
            document.getElementById('cccd').value = emp.cccd;
            document.getElementById('danToc').value = emp.danToc || '';
            document.getElementById('tonGiao').value = emp.tonGiao || '';
            document.getElementById('ngayTiepNhan').value = emp.ngayTiepNhan || new Date().toISOString().substring(0, 10);
            
            // ƒê·ªãa ch·ªâ
            document.getElementById('noiSinhTP').value = emp.noiSinhTP || '';
            document.getElementById('noiSinhPhuong').value = emp.noiSinhPhuong || '';
            document.getElementById('queQuanTP').value = emp.queQuanTP || '';
            document.getElementById('queQuanPhuong').value = emp.queQuanPhuong || '';
            document.getElementById('thuongTruTP').value = emp.thuongTruTP || '';
            document.getElementById('diaChiThuongTru').value = emp.diaChiThuongTru;
            
            // C√¥ng t√°c
            document.getElementById('boPhanCongTac').value = emp.boPhanCongTac;
            document.getElementById('congTacChinhDangLam').value = emp.congTacChinhDangLam;
            document.getElementById('dienThoai').value = emp.dienThoai || '';

            // M·ªü modal nh·∫≠p li·ªáu v·ªõi d·ªØ li·ªáu ƒë√£ fill
            openModal('modalDataEntry');
            
            // Hi·ªÉn th·ªã th√¥ng b√°o
            setTimeout(() => {
                alert(`‚úÖ ƒê√£ t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin t·ª´ HSNV: ${emp.hoTen} (${emp.maNV})\n\nüìù Vui l√≤ng ki·ªÉm tra v√† b·ªï sung c√°c tr∆∞·ªùng c√≤n thi·∫øu.`);
            }, 500);
        };

        // H√†m c·∫≠p nh·∫≠t chi b·ªô cha
        window.updateChiBoCha = () => {
            const donVi = document.getElementById('donVi').value;
            const chiBoChaInput = document.getElementById('chiBoCha');
            
            if (donVi) {
                chiBoChaInput.value = "ƒê·∫£ng ·ªßy Kh·ªëi C∆° quan";
            } else {
                chiBoChaInput.value = "";
            }
        };

        // H√†m m·ªü modal nh·∫≠p tay h·ªì s∆° m·ªõi (T√°ch ra t·ª´ modalAddNewOption)
        window.openManualEntry = () => {
            closeModal('modalAddNewOption');
            // ƒê·∫£m b·∫£o form s·∫°ch khi m·ªü nh·∫≠p m·ªõi
            document.getElementById('qcRecordId').value = ''; 
            document.getElementById('qcForm').reset();
            document.getElementById('fromHSNV').value = 'false';
            
            // Set ng√†y ti·∫øp nh·∫≠n m·∫∑c ƒë·ªãnh l√† h√¥m nay
            document.getElementById('ngayTiepNhan').value = new Date().toISOString().substring(0, 10);
            
            openModal('modalDataEntry');
        };


        // --- HELPER FUNCTIONS ---
        const getStatusBadge = (status) => {
            let color = 'bg-gray-100 text-gray-800';
            if (status.includes('Ho√†n th√†nh')) color = 'bg-green-100 text-green-700';
            else if (status.includes('ƒêang th·ª±c hi·ªán') || status.includes('ƒêang h·ªçc') || status.includes('ƒêang r√®n luy·ªán')) color = 'bg-yellow-100 text-yellow-700';
            else if (status.includes('Ko ho√†n th√†nh')) color = 'bg-red-100 text-red-700';
            else if (status.includes('L·ªõp Nh·∫≠n th·ª©c')) color = 'bg-blue-100 text-blue-700';
            else if (status.includes('R√®n luy·ªán')) color = 'bg-purple-100 text-purple-700';
            else if (status.includes('Ho√†n thi·ªán')) color = 'bg-indigo-100 text-indigo-700';
            
            return `<span class="px-2 py-1 font-semibold leading-tight ${color} rounded-full text-xs">${status}</span>`;
        };

        // H√†m c·∫≠p nh·∫≠t tr·∫°ng th√°i ti·∫øn tr√¨nh c·ªßa H·ªì s∆°
        window.updateRecordProgress = (recordId, stepName, status, note = null) => {
            const record = mockData.find(d => d.id === recordId);
            if (!record) return;

            const now = new Date().toLocaleDateString('vi-VN');
            const stepIndex = Object.values(STEPS).indexOf(stepName);

            // 1. C·∫≠p nh·∫≠t tr·∫°ng th√°i t·ªïng qu√°t
            record.trangThai = stepName;
            record.currentStepIndex = stepIndex;

            // 2. C·∫≠p nh·∫≠t chi ti·∫øt Timeline
            let progressItem = record.progress.find(p => p.step === stepName);
            if (!progressItem) {
                // T·∫°o m·ªõi n·∫øu ch∆∞a c√≥
                progressItem = { step: stepName, status: status, start: now, end: status === 'Ho√†n th√†nh' ? now : 'N/A', note: note || "" };
                record.progress.splice(stepIndex, 0, progressItem);
            } else {
                // C·∫≠p nh·∫≠t existing item
                if (progressItem.status === 'Ch∆∞a b·∫Øt ƒë·∫ßu' || !progressItem.start || progressItem.start === 'N/A') {
                    progressItem.start = now; // Ghi nh·∫≠n ng√†y b·∫Øt ƒë·∫ßu n·∫øu ch∆∞a c√≥
                }
                progressItem.status = status;
                if (status.includes('Ho√†n th√†nh')) {
                    progressItem.end = now;
                } else if (status.includes('ƒêang th·ª±c hi·ªán') || status.includes('ƒêang h·ªçc') || status.includes('ƒêang r√®n luy·ªán')) {
                    progressItem.end = 'N/A';
                }
                if (note) {
                    progressItem.note = note;
                }
            }

            // 3. X·ª≠ l√Ω logic chuy·ªÉn b∆∞·ªõc t·ª± ƒë·ªông (LOP_NHAN_THUC -> REN_LUYEN)
            if (stepName === STEPS.LOP_NHAN_THUC && status === 'Ho√†n th√†nh') {
                const nextStepIndex = Object.values(STEPS).indexOf(STEPS.REN_LUYEN);
                
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i t·ªïng qu√°t l√™n REN_LUYEN
                record.trangThai = STEPS.REN_LUYEN;
                record.currentStepIndex = nextStepIndex;

                // C·∫≠p nh·∫≠t chi ti·∫øt Timeline cho REN_LUYEN
                let nextProgressItem = record.progress.find(p => p.step === STEPS.REN_LUYEN);
                if (!nextProgressItem) {
                    nextProgressItem = { step: STEPS.REN_LUYEN, status: "ƒêang th·ª±c hi·ªán", start: now, end: "N/A", note: "Chuy·ªÉn sang R√®n luy·ªán sau khi ho√†n th√†nh L·ªõp nh·∫≠n th·ª©c." };
                    record.progress.splice(nextStepIndex, 0, nextProgressItem);
                } else {
                    nextProgressItem.status = "ƒêang th·ª±c hi·ªán";
                    if (!nextProgressItem.start || nextProgressItem.start === 'N/A') { nextProgressItem.start = now; }
                    nextProgressItem.note = "Chuy·ªÉn sang R√®n luy·ªán sau khi ho√†n th√†nh L·ªõp nh·∫≠n th·ª©c.";
                    nextProgressItem.end = 'N/A';
                }
                
                // Kh·ªüi t·∫°o tr·∫°ng th√°i r√®n luy·ªán
                if (!record.trainingStatus) {
                    record.trainingStatus = "ƒêang r√®n luy·ªán";
                }
            }

            // 4. X·ª≠ l√Ω logic chuy·ªÉn b∆∞·ªõc t·ª± ƒë·ªông (REN_LUYEN -> HOAN_THIEN)
            if (stepName === STEPS.REN_LUYEN && status === 'Ho√†n th√†nh') {
                const nextStepIndex = Object.values(STEPS).indexOf(STEPS.HOAN_THIEN);
                
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i t·ªïng qu√°t l√™n HOAN_THIEN
                record.trangThai = STEPS.HOAN_THIEN;
                record.currentStepIndex = nextStepIndex;

                // C·∫≠p nh·∫≠t chi ti·∫øt Timeline cho HOAN_THIEN
                let nextProgressItem = record.progress.find(p => p.step === STEPS.HOAN_THIEN);
                if (!nextProgressItem) {
                    nextProgressItem = { step: STEPS.HOAN_THIEN, status: "ƒêang th·ª±c hi·ªán", start: now, end: "N/A", note: "Chuy·ªÉn sang Ho√†n thi·ªán h·ªì s∆° sau r√®n luy·ªán." };
                    record.progress.splice(nextStepIndex, 0, nextProgressItem);
                } else {
                    nextProgressItem.status = "ƒêang th·ª±c hi·ªán";
                    if (!nextProgressItem.start || nextProgressItem.start === 'N/A') { nextProgressItem.start = now; }
                    nextProgressItem.note = "Chuy·ªÉn sang Ho√†n thi·ªán h·ªì s∆° sau r√®n luy·ªán."
                    nextProgressItem.end = 'N/A';
                }
            }

            // 5. X·ª≠ l√Ω logic chuy·ªÉn b∆∞·ªõc t·ª± ƒë·ªông (HOAN_THIEN -> KET_NAP)
            if (stepName === STEPS.HOAN_THIEN && status === 'Ho√†n th√†nh') {
                const nextStepIndex = Object.values(STEPS).indexOf(STEPS.KET_NAP);
                
                // C·∫≠p nh·∫≠t tr·∫°ng th√°i t·ªïng qu√°t l√™n KET_NAP
                record.trangThai = STEPS.KET_NAP;
                record.currentStepIndex = nextStepIndex;

                // Kh·ªüi t·∫°o tr·∫°ng th√°i k·∫øt n·∫°p
                if (!record.ketNapStatus) {
                    record.ketNapStatus = "ƒêang th·ª±c hi·ªán";
                }

                // C·∫≠p nh·∫≠t chi ti·∫øt Timeline cho KET_NAP
                let nextProgressItem = record.progress.find(p => p.step === STEPS.KET_NAP);
                if (!nextProgressItem) {
                    nextProgressItem = { step: STEPS.KET_NAP, status: "ƒêang th·ª±c hi·ªán", start: now, end: "N/A", note: "Chuy·ªÉn sang Quy·∫øt ƒë·ªãnh k·∫øt n·∫°p sau khi ƒë·ªß h·ªì s∆°." };
                    record.progress.splice(nextStepIndex, 0, nextProgressItem);
                } else {
                    nextProgressItem.status = "ƒêang th·ª±c hi·ªán";
                    if (!nextProgressItem.start || nextProgressItem.start === 'N/A') { nextProgressItem.start = now; }
                    nextProgressItem.note = "Chuy·ªÉn sang Quy·∫øt ƒë·ªãnh k·∫øt n·∫°p sau khi ƒë·ªß h·ªì s∆°."
                    nextProgressItem.end = 'N/A';
                }
            }

            // ƒê·ªìng b·ªô tr·∫°ng th√°i L·ªõp nh·∫≠n th·ª©c (n·∫øu √°p d·ª•ng)
            if (stepName === STEPS.LOP_NHAN_THUC && status.includes('Ho√†n th√†nh')) {
                record.classStatus = 'Ho√†n th√†nh';
            }


            // Re-render UI
            const activeTarget = document.querySelector('.nav-step.active')?.getAttribute('data-target');
            if (activeTarget === 'quan-chung') {
                renderQCTable();
            } else if (activeTarget === 'lop-nhan-thuc') {
                 if (document.getElementById('modalClassDetail').classList.contains('flex')) {
                    renderClassStudentList(currentClassId);
                 }
                 renderClassTable();
            } else if (activeTarget === 'ren-luyen') {
                 if (document.getElementById('modalMentorDetail').classList.contains('flex')) {
                    renderMentorStudentList(currentMentorId);
                 }
                 renderMentorTable();
            } else if (activeTarget === 'hoan-thien') {
                 renderDocumentCompletionTable();
            } else if (activeTarget === 'ket-nap') {
                 renderAdmissionDecisionTable();
            }

            console.log(`Ti·∫øn tr√¨nh HS ${recordId} c·∫≠p nh·∫≠t: ${stepName} - ${status}`);
        };

        // FIX: ƒê·ªãnh nghƒ©a h√†m b·ªã thi·∫øu
        window.openClassStatusUpdateModal = () => {
            const cls = mockClasses.find(c => c.id === currentClassId);
            if (!cls) return;

            const studentsInClass = mockData.filter(d => d.classId === currentClassId);
            const dangHoc = studentsInClass.filter(d => d.classStatus === 'ƒêang h·ªçc').length;
            const hoanThanh = studentsInClass.filter(d => d.classStatus === 'Ho√†n th√†nh').length;
            const khongHoanThanh = studentsInClass.filter(d => d.classStatus === 'Kh√¥ng ho√†n th√†nh').length;

            const message = `üéì L·ªõp: ${cls.name}\nüìä Th·ªëng k√™:\n  ‚Ä¢ ƒêang h·ªçc: ${dangHoc} h·ªçc vi√™n\n  ‚Ä¢ Ho√†n th√†nh: ${hoanThanh} h·ªçc vi√™n\n  ‚Ä¢ Kh√¥ng ho√†n th√†nh: ${khongHoanThanh} h·ªçc vi√™n\n\n‚ùì B·∫°n mu·ªën chuy·ªÉn tr·∫°ng th√°i l·ªõp sang?`;

            const choice = confirm(`${message}\n\nCh·ªçn:\n‚úÖ OK: Ho√†n th√†nh\n‚ùå Cancel: Kh√¥ng ho√†n th√†nh`);

            if (choice) {
                // Ho√†n th√†nh l·ªõp
                cls.status = 'Ho√†n th√†nh';
                
                // C·∫≠p nh·∫≠t t·∫•t c·∫£ h·ªçc vi√™n Ho√†n th√†nh ‚Üí REN_LUYEN
                studentsInClass.forEach(student => {
                    if (student.classStatus === 'Ho√†n th√†nh') {
                        updateRecordProgress(student.id, STEPS.LOP_NHAN_THUC, 'Ho√†n th√†nh', `Ho√†n th√†nh l·ªõp ${cls.name}. T·ª± ƒë·ªông chuy·ªÉn sang R√®n luy·ªán.`);
                    } else if (student.classStatus === 'Kh√¥ng ho√†n th√†nh') {
                        updateRecordProgress(student.id, STEPS.LOP_NHAN_THUC, 'Kh√¥ng ho√†n th√†nh', `Kh√¥ng ho√†n th√†nh l·ªõp ${cls.name}.`);
                    }
                });

                alert(`‚úÖ ƒê√£ chuy·ªÉn l·ªõp "${cls.name}" sang tr·∫°ng th√°i "Ho√†n th√†nh".\n\nüìã ${hoanThanh} h·ªçc vi√™n ho√†n th√†nh ƒë√£ ƒë∆∞·ª£c t·ª± ƒë·ªông chuy·ªÉn sang b∆∞·ªõc "R√®n luy·ªán".`);
            } else {
                // Kh√¥ng ho√†n th√†nh l·ªõp
                cls.status = 'Kh√¥ng ho√†n th√†nh';
                
                studentsInClass.forEach(student => {
                    updateRecordProgress(student.id, STEPS.LOP_NHAN_THUC, 'Kh√¥ng ho√†n th√†nh', `L·ªõp ${cls.name} kh√¥ng ho√†n th√†nh.`);
                });

                alert(`‚ö†Ô∏è ƒê√£ chuy·ªÉn l·ªõp "${cls.name}" sang tr·∫°ng th√°i "Kh√¥ng ho√†n th√†nh".\n\nT·∫•t c·∫£ h·ªçc vi√™n ƒë√£ ƒë∆∞·ª£c ƒë√°nh d·∫•u kh√¥ng ho√†n th√†nh.`);
            }

            closeModal('modalClassDetail');
            
            // Re-render
            const activeTarget = document.querySelector('.nav-step.active')?.getAttribute('data-target');
            if (activeTarget === 'lop-nhan-thuc') {
                mainContent.innerHTML = renderClassTable();
            }
            renderQCTable();
        };


        // --- LOGIC FOR TAB: Qu·∫ßn Ch√∫ng ∆Øu T√∫ (QC) ---

        const renderQCTable = () => {
            const rows = mockData.map(item => `
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="openSlideIn(${item.id})">
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap font-medium">${item.hoTen}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${item.gioiTinh}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${item.donVi}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${new Date(item.ngayTiepNhan).toLocaleDateString('vi-VN')}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${new Date(item.ngaySinh).toLocaleDateString('vi-VN')}</td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${item.cccd}</td>
                    <td class="p-3 text-sm whitespace-nowrap">
                        ${getStatusBadge(item.trangThai)}
                    </td>
                    <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">
                        <button onclick="event.stopPropagation(); openEditQCModal(${item.id});" class="text-blue-600 hover:text-blue-800 mr-2"><i class="fas fa-edit"></i></button>
                        <button onclick="event.stopPropagation(); deleteRecord(${item.id});" class="text-red-600 hover:text-red-800"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');

            return `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Danh s√°ch Qu·∫ßn Ch√∫ng ∆Øu T√∫</h2>
                    <button onclick="openModal('modalAddNewOption')" class="bg-primary-red text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition shadow-md">
                        <i class="fas fa-plus mr-2"></i> Th√™m m·ªõi
                    </button>
                </div>
                
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">H·ªç v√† t√™n</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Gi·ªõi t√≠nh</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">ƒê∆°n v·ªã</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y TN</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y sinh</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">CMND/CCCD</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i</th>
                                <th class="px-3 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">H√†nh ƒë·ªông</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${rows}
                        </tbody>
                    </table>
                </div>
            `;
        };

        window.openEditQCModal = (id) => {
            const record = mockData.find(d => d.id === id);
            if (!record) return;

            document.getElementById('qcRecordId').value = record.id;
            document.getElementById('fromHSNV').value = 'false';
            
            // I. Th√¥ng tin c∆° b·∫£n
            document.getElementById('hoTen').value = record.hoTen || '';
            document.getElementById('maNV').value = record.maNV || '';
            document.getElementById('donVi').value = record.donVi || '';
            document.getElementById('chiBoCha').value = record.chiBoCha || 'ƒê·∫£ng ·ªßy Kh·ªëi C∆° quan';
            document.getElementById('chucDanh').value = record.chucDanh || '';
            document.getElementById('chucDanhChinhQuyen').value = record.chucDanhChinhQuyen || '';
            document.getElementById('chucDanhDoanThe').value = record.chucDanhDoanThe || '';
            document.getElementById('gioiTinh').value = record.gioiTinh || '';
            document.getElementById('ngaySinh').value = record.ngaySinh || '';
            document.getElementById('cccd').value = record.cccd || '';
            document.getElementById('danToc').value = record.danToc || '';
            document.getElementById('tonGiao').value = record.tonGiao || '';
            document.getElementById('ngayTiepNhan').value = record.ngayTiepNhan || '';
            
            // II. ƒê·ªãa ch·ªâ
            document.getElementById('noiSinhTP').value = record.noiSinhTP || '';
            document.getElementById('noiSinhPhuong').value = record.noiSinhPhuong || '';
            document.getElementById('diaChiNoiSinh').value = record.diaChiNoiSinh || '';
            document.getElementById('queQuanTP').value = record.queQuanTP || '';
            document.getElementById('queQuanPhuong').value = record.queQuanPhuong || '';
            document.getElementById('diaChiQueQuan').value = record.diaChiQueQuan || '';
            document.getElementById('noiOHienNayTP').value = record.noiOHienNayTP || '';
            document.getElementById('noiOHienNayPhuong').value = record.noiOHienNayPhuong || '';
            document.getElementById('diaChiNoiOHienNay').value = record.diaChiNoiOHienNay || '';
            document.getElementById('thuongTruTP').value = record.thuongTruTP || '';
            document.getElementById('diaChiThuongTru').value = record.diaChiThuongTru || '';
            document.getElementById('thanhPhanGiaDinh').value = record.thanhPhanGiaDinh || '';
            
            // III. C√¥ng t√°c
            document.getElementById('ngheNghiepTruocTuyenDung').value = record.ngheNghiepTruocTuyenDung || '';
            document.getElementById('ngayTuyenDung').value = record.ngayTuyenDung || '';
            document.getElementById('donViTuyenDung').value = record.donViTuyenDung || '';
            document.getElementById('ngayVaoCoQuan').value = record.ngayVaoCoQuan || '';
            document.getElementById('boPhanCongTac').value = record.boPhanCongTac || '';
            document.getElementById('congTacChinhDangLam').value = record.congTacChinhDangLam || '';
            document.getElementById('ngachCongChuc').value = record.ngachCongChuc || '';
            document.getElementById('bacLuong').value = record.bacLuong || '';
            document.getElementById('heSo').value = record.heSo || '';
            document.getElementById('tuThang').value = record.tuThang || '';
            document.getElementById('soTruongCongTac').value = record.soTruongCongTac || '';
            document.getElementById('congViecLauNhat').value = record.congViecLauNhat || '';
            document.getElementById('dienThoai').value = record.dienThoai || '';
            document.getElementById('danhHieu').value = record.danhHieu || '';

            openModal('modalDataEntry');
        };

        // --- LOGIC FOR TAB: L·ªõp Nh·∫≠n Th·ª©c (LNT) ---
        
        const renderClassTable = () => {
            const rows = mockClasses.map(cls => {
                const totalStudents = mockData.filter(d => d.classId === cls.id).length;
                // Ho√†n th√†nh ·ªü ƒë√¢y l√† ƒë√£ chuy·ªÉn sang b∆∞·ªõc R√®n Luy·ªán (REN_LUYEN)
                const completedStudents = mockData.filter(d => d.classId === cls.id && d.trangThai === STEPS.REN_LUYEN).length;
                
                let statusBadge = getStatusBadge(cls.status);
                let actions = `
                    <button onclick="event.stopPropagation(); openClassDetailModal(${cls.id});" class="text-indigo-600 hover:text-indigo-800 mr-2" title="Xem Chi ti·∫øt"><i class="fas fa-eye"></i></button>
                    <button onclick="event.stopPropagation(); deleteClass(${cls.id});" class="text-red-600 hover:text-red-800" title="X√≥a L·ªõp"><i class="fas fa-trash"></i></button>
                `;

                return `
                    <tr class="hover:bg-gray-50 cursor-pointer" onclick="openClassDetailModal(${cls.id})">
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap font-medium">${cls.name}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${new Date(cls.start).toLocaleDateString('vi-VN')}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${new Date(cls.end).toLocaleDateString('vi-VN')}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-center">${totalStudents}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-center">${completedStudents}</td>
                        <td class="p-3 text-sm whitespace-nowrap">${statusBadge}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">${actions}</td>
                    </tr>
                `;
            }).join('');

            return `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Danh s√°ch L·ªõp Nh·∫≠n Th·ª©c</h2>
                    <button onclick="openModal('modalCreateClass')" class="bg-primary-red text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition shadow-md">
                        <i class="fas fa-plus mr-2"></i> T·∫°o m·ªõi L·ªõp
                    </button>
                </div>
                
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">T√™n l·ªõp</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y Bƒê</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y KT</th>
                                <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Sƒ© s·ªë</th>
                                <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Ho√†n th√†nh</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i l·ªõp</th>
                                <th class="px-3 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${rows}
                        </tbody>
                    </table>
                </div>
            `;
        };
        
        // X·ª≠ l√Ω submit form t·∫°o l·ªõp m·ªõi
        window.handleClassSubmit = (event) => {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const className = formData.get('className');
            const classYear = formData.get('classYear');
            const classStart = formData.get('classStart');
            const classEnd = formData.get('classEnd');
            const classNote = formData.get('classNote');

            // Validate ng√†y
            if (new Date(classStart) > new Date(classEnd)) {
                alert('‚ö†Ô∏è Ng√†y b·∫Øt ƒë·∫ßu ph·∫£i tr∆∞·ªõc ng√†y k·∫øt th√∫c!');
                return;
            }

            // T·∫°o l·ªõp m·ªõi
            const newClass = {
                id: mockClasses.length > 0 ? Math.max(...mockClasses.map(c => c.id)) + 1 : 1,
                name: className,
                year: parseInt(classYear),
                start: classStart,
                end: classEnd,
                status: "ƒêang h·ªçc",
                note: classNote || "",
                students: []
            };

            mockClasses.push(newClass);
            
            closeModal('modalCreateClass');
            event.target.reset();
            
            // Re-render
            const activeTarget = document.querySelector('.nav-step.active')?.getAttribute('data-target');
            if (activeTarget === 'lop-nhan-thuc') {
                mainContent.innerHTML = renderClassTable();
            }
            
            alert(`‚úÖ ƒê√£ t·∫°o l·ªõp "${className}" th√†nh c√¥ng!`);
        };

        // X√≥a l·ªõp
        window.deleteClass = (classId) => {
            const cls = mockClasses.find(c => c.id === classId);
            if (!cls) return;

            const studentCount = mockData.filter(d => d.classId === classId).length;
            
            if (studentCount > 0) {
                if (!confirm(`‚ö†Ô∏è L·ªõp "${cls.name}" c√≥ ${studentCount} h·ªçc vi√™n.\n\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a? C√°c h·ªçc vi√™n s·∫Ω b·ªã x√≥a kh·ªèi l·ªõp.`)) {
                    return;
                }
                
                // X√≥a h·ªçc vi√™n kh·ªèi l·ªõp
                mockData.forEach(d => {
                    if (d.classId === classId) {
                        d.classId = null;
                        d.classEntryDate = null;
                        d.classStatus = null;
                        
                        // Rollback tr·∫°ng th√°i v·ªÅ Qu·∫ßn ch√∫ng ∆∞u t√∫ n·∫øu ƒëang ·ªü L·ªõp nh·∫≠n th·ª©c
                        if (d.trangThai === STEPS.LOP_NHAN_THUC) {
                            updateRecordProgress(d.id, STEPS.QUAN_CHUNG, 'ƒêang th·ª±c hi·ªán', 'ƒê√£ x√≥a kh·ªèi l·ªõp nh·∫≠n th·ª©c.');
                        }
                    }
                });
            } else {
                if (!confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a l·ªõp "${cls.name}"?`)) {
                    return;
                }
            }

            mockClasses = mockClasses.filter(c => c.id !== classId);
            
            // Re-render
            const activeTarget = document.querySelector('.nav-step.active')?.getAttribute('data-target');
            if (activeTarget === 'lop-nhan-thuc') {
                mainContent.innerHTML = renderClassTable();
            }
            
            renderQCTable();
            alert(`‚úÖ ƒê√£ x√≥a l·ªõp th√†nh c√¥ng!`);
        };

        // M·ªü modal chi ti·∫øt l·ªõp
        window.openClassDetailModal = (classId) => {
            const cls = mockClasses.find(c => c.id === classId);
            if (!cls) return;
            currentClassId = classId;

            const students = mockData.filter(d => d.classId === classId);
            const completedStudents = students.filter(d => d.classStatus === 'Ho√†n th√†nh').length;

            document.getElementById('detailClassName').textContent = cls.name;
            document.getElementById('detailClassYear').textContent = cls.year;
            document.getElementById('detailClassDates').textContent = `${new Date(cls.start).toLocaleDateString('vi-VN')} - ${new Date(cls.end).toLocaleDateString('vi-VN')}`;
            document.getElementById('detailClassSize').textContent = students.length;
            document.getElementById('detailClassCompleted').textContent = completedStudents;
            document.getElementById('detailClassStatus').textContent = cls.status;
            document.getElementById('detailClassNote').textContent = cls.note || 'Kh√¥ng c√≥ ghi ch√∫';
            document.getElementById('currentClassSize').textContent = students.length;

            renderClassStudentList(classId);
            openModal('modalClassDetail');
        };

        // Render danh s√°ch h·ªçc vi√™n trong l·ªõp
        const renderClassStudentList = (classId) => {
            const studentsInClass = mockData.filter(d => d.classId === classId);
            const total = studentsInClass.length;

            document.getElementById('detailClassSize').textContent = total;
            document.getElementById('currentClassSize').textContent = total;

            const studentRows = studentsInClass.map(student => {
                const status = student.classStatus || "ƒêang h·ªçc";
                let actions = '';
                
                // N√∫t c·∫≠p nh·∫≠t tr·∫°ng th√°i
                if (status === "ƒêang h·ªçc") {
                    actions = `
                        <button onclick="event.stopPropagation(); updateStudentResult(${student.id}, 'Ho√†n th√†nh');" class="text-green-600 hover:text-green-800 mr-2" title="Ho√†n th√†nh"><i class="fas fa-check-circle"></i></button>
                        <button onclick="event.stopPropagation(); updateStudentResult(${student.id}, 'Kh√¥ng ho√†n th√†nh');" class="text-red-600 hover:text-red-800 mr-2" title="Kh√¥ng ho√†n th√†nh"><i class="fas fa-times-circle"></i></button>
                    `;
                }
                actions += `<button onclick="event.stopPropagation(); removeStudentFromClass(${student.id});" class="text-orange-600 hover:text-orange-800" title="X√≥a kh·ªèi l·ªõp"><i class="fas fa-user-times"></i></button>`;
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap font-medium">${student.hoTen}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${student.maNV || 'N/A'}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${student.donVi}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${student.chucDanh || 'N/A'}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${student.classEntryDate ? new Date(student.classEntryDate).toLocaleDateString('vi-VN') : 'N/A'}</td>
                        <td class="p-3 text-sm whitespace-nowrap">${getStatusBadge(status)}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">${actions}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('classStudentList').innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">H·ªç v√† t√™n</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">M√£ h·ªì s∆° / NV</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">T·ªï ch·ª©c / Chi b·ªô</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ch·ª©c danh</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y v√†o l·ªõp</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i l·ªõp</th>
                            <th class="px-3 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${studentRows.length > 0 ? studentRows : '<tr><td colspan="7" class="p-4 text-center text-gray-500">Ch∆∞a c√≥ h·ªçc vi√™n n√†o trong l·ªõp.</td></tr>'}
                    </tbody>
                </table>
            `;
        };

        // M·ªü modal th√™m h·ªçc vi√™n
        window.openAddStudentModal = () => {
            // Ch·ªâ l·∫•y h·ªì s∆° ·ªü b∆∞·ªõc Qu·∫ßn ch√∫ng ∆∞u t√∫ (Step 0) v√† ch∆∞a c√≥ l·ªõp
            const availableStudents = mockData.filter(d => 
                d.trangThai === STEPS.QUAN_CHUNG && 
                d.classId === null
            );
            
            const listHTML = availableStudents.map(student => `
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border hover:bg-blue-50 transition">
                    <div class="flex items-center flex-1">
                        <input type="checkbox" data-id="${student.id}" onchange="updateSelectedCount()" class="form-checkbox text-primary-red h-5 w-5 rounded mr-3">
                        <div>
                            <p class="text-sm font-semibold text-gray-800">${student.hoTen} <span class="text-gray-500">(${student.maNV || 'N/A'})</span></p>
                            <p class="text-xs text-gray-500">${student.donVi} - ${student.chucDanh || 'N/A'}</p>
                        </div>
                    </div>
                    <span class="px-2 py-1 text-xs font-semibold bg-gray-100 text-gray-700 rounded">${student.trangThai}</span>
                </div>
            `).join('');

            document.getElementById('availableStudentsList').innerHTML = listHTML.length > 0 
                ? listHTML 
                : '<p class="p-3 text-center text-gray-500">Kh√¥ng c√≥ h·ªì s∆° n√†o ƒë·ªß ƒëi·ªÅu ki·ªán (ph·∫£i ·ªü b∆∞·ªõc Qu·∫ßn ch√∫ng ∆∞u t√∫ v√† ch∆∞a tham gia l·ªõp).</p>';
            
            document.getElementById('selectedCount').textContent = '0';
            openModal('modalAddStudent');
        };

        window.updateSelectedCount = () => {
            const count = document.querySelectorAll('#availableStudentsList input[type="checkbox"]:checked').length;
            document.getElementById('selectedCount').textContent = count;
        };

        // Th√™m h·ªçc vi√™n ƒë√£ ch·ªçn v√†o l·ªõp
        window.addSelectedStudents = () => {
            const selectedIds = Array.from(document.querySelectorAll('#availableStudentsList input[type="checkbox"]:checked'))
                .map(checkbox => parseInt(checkbox.dataset.id));

            if (selectedIds.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt h·ªçc vi√™n.');
                return;
            }

            const cls = mockClasses.find(c => c.id === currentClassId);
            if (!cls) return;

            const now = new Date().toISOString().substring(0, 10);

            selectedIds.forEach(id => {
                const record = mockData.find(d => d.id === id);
                if (record) {
                    // G√°n v√†o l·ªõp
                    record.classId = currentClassId;
                    record.classEntryDate = now;
                    record.classStatus = 'ƒêang h·ªçc';
                    
                    // C·∫≠p nh·∫≠t tr·∫°ng th√°i ti·∫øn tr√¨nh sang L·ªõp nh·∫≠n th·ª©c
                    updateRecordProgress(id, STEPS.LOP_NHAN_THUC, 'ƒêang th·ª±c hi·ªán', `Tham gia ${cls.name}. ƒêang h·ªçc t·∫≠p.`);
                }
            });

            closeModal('modalAddStudent');
            renderClassStudentList(currentClassId);
            
            // Re-render b·∫£ng class v√† QCUT
            const activeTarget = document.querySelector('.nav-step.active')?.getAttribute('data-target');
            if (activeTarget === 'lop-nhan-thuc') {
                mainContent.innerHTML = renderClassTable();
                openClassDetailModal(currentClassId); // M·ªü l·∫°i modal chi ti·∫øt
            }
            renderQCTable();
            
            alert(`‚úÖ ƒê√£ th√™m ${selectedIds.length} h·ªçc vi√™n v√†o l·ªõp "${cls.name}" th√†nh c√¥ng!\n\nüìã Tr·∫°ng th√°i h·ªì s∆° ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t sang "L·ªõp nh·∫≠n th·ª©c".`);
        };

        // X√≥a h·ªçc vi√™n kh·ªèi l·ªõp
        window.removeStudentFromClass = (studentId) => {
            if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªçc vi√™n n√†y kh·ªèi l·ªõp?")) return;
            
            const student = mockData.find(d => d.id === studentId);
            if (student) {
                const classId = student.classId;
                
                // X√≥a kh·ªèi l·ªõp
                student.classId = null;
                student.classEntryDate = null;
                student.classStatus = null;

                // Rollback tr·∫°ng th√°i v·ªÅ Qu·∫ßn ch√∫ng ∆∞u t√∫
                updateRecordProgress(studentId, STEPS.QUAN_CHUNG, 'ƒêang th·ª±c hi·ªán', `ƒê√£ x√≥a kh·ªèi l·ªõp. Ch·ªù ph√¢n l·ªõp l·∫°i.`);

                renderClassStudentList(classId);
                
                // Re-render
                const activeTarget = document.querySelector('.nav-step.active')?.getAttribute('data-target');
                if (activeTarget === 'lop-nhan-thuc') {
                    mainContent.innerHTML = renderClassTable();
                    openClassDetailModal(classId);
                }
                renderQCTable();
            }
        };
        
        // C·∫≠p nh·∫≠t k·∫øt qu·∫£ h·ªçc vi√™n
        window.updateStudentResult = (studentId, status) => {
            const student = mockData.find(d => d.id === studentId);
            if (!student) return;

            student.classStatus = status;

            if (status === 'Ho√†n th√†nh') {
                // T·ª± ƒë·ªông chuy·ªÉn tr·∫°ng th√°i ho√†n th√†nh LNT
                let note = `Ho√†n th√†nh L·ªõp Nh·∫≠n th·ª©c ${mockClasses.find(c=>c.id === student.classId).name}. S·∫µn s√†ng cho R√®n luy·ªán th·ª≠ th√°ch.`;
                updateRecordProgress(studentId, STEPS.LOP_NHAN_THUC, 'Ho√†n th√†nh', note);

                // Lo·∫°i b·ªè tr·∫°ng th√°i r√®n luy·ªán n·∫øu ƒë√£ c√≥, ƒë·ªÉ ch·ªù g√°n
                student.mentorId = null; 
                student.trainingStatus = null;
            }
            
            renderClassStudentList(currentClassId);
            renderQCTable(); // C·∫≠p nh·∫≠t c·∫£ b·∫£ng QCUT
        };

        // --- LOGIC FOR TAB: Ho√†n thi·ªán H·ªì s∆° (HTHS) ---

        const renderDocumentCompletionTable = () => {
            // L·∫•y danh s√°ch h·ªì s∆° ƒë√£ ho√†n th√†nh R√®n luy·ªán (trangThai >= HOAN_THIEN)
            const profilesInDocCompletion = mockData.filter(d => 
                d.currentStepIndex >= Object.values(STEPS).indexOf(STEPS.HOAN_THIEN)
            );
            
            const rows = profilesInDocCompletion.map(profile => {
                const mentor = profile.mentorId ? mockMentors.find(m => m.id === profile.mentorId) : null;
                
                // T√≠nh ti·∫øn ƒë·ªô ho√†n th√†nh t√†i li·ªáu
                const docs = profile.documents || {};
                const completedDocs = Object.values(docs).filter(v => v === true).length;
                const totalDocs = REQUIRED_DOCUMENTS.length;
                const progressPercent = Math.round((completedDocs / totalDocs) * 100);
                
                // Tr·∫°ng th√°i t·ªïng
                const overallStatus = completedDocs === totalDocs ? 'ƒê·ªß h·ªì s∆°' : 'Ch∆∞a ƒë·ªß';
                const statusBadge = completedDocs === totalDocs 
                    ? '<span class="px-2 py-1 font-semibold leading-tight bg-green-100 text-green-700 rounded-full text-xs">ƒê·ªß h·ªì s∆°</span>'
                    : '<span class="px-2 py-1 font-semibold leading-tight bg-yellow-100 text-yellow-700 rounded-full text-xs">Ch∆∞a ƒë·ªß</span>';

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3">
                            <input type="checkbox" data-profile-id="${profile.id}" class="form-checkbox text-primary-red h-4 w-4 rounded profile-checkbox" onchange="updateBulkSelectedCount()">
                        </td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap font-medium">${profile.hoTen}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${profile.chucDanh || 'N/A'}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${profile.donVi}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${mentor ? mentor.hoTen : 'N/A'}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">
                            <div class="flex items-center">
                                <div class="w-full bg-gray-200 rounded-full h-2 mr-2">
                                    <div class="bg-primary-red h-2 rounded-full" style="width: ${progressPercent}%"></div>
                                </div>
                                <span class="text-xs font-bold text-gray-700">${completedDocs}/${totalDocs}</span>
                            </div>
                        </td>
                        <td class="p-3 text-sm whitespace-nowrap">${statusBadge}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">
                            <button onclick="openDocumentDetailModal(${profile.id})" class="text-indigo-600 hover:text-indigo-800" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye mr-1"></i>Chi ti·∫øt
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            return `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Danh s√°ch H·ªì s∆° Ho√†n thi·ªán T√†i li·ªáu</h2>
                    <button onclick="openBulkUpdateModal()" class="bg-primary-red text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition shadow-md">
                        <i class="fas fa-sync-alt mr-2"></i> C·∫≠p nh·∫≠t H√†ng lo·∫°t
                    </button>
                </div>
                
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    <input type="checkbox" id="selectAllProfiles" class="form-checkbox text-primary-red h-4 w-4 rounded" onchange="toggleSelectAllProfiles(this)">
                                </th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">H·ªç v√† t√™n</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ch·ª©c danh</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">ƒê∆°n v·ªã</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng∆∞·ªùi h∆∞·ªõng d·∫´n</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ti·∫øn ƒë·ªô ho√†n th√†nh t√†i li·ªáu</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i t·ªïng</th>
                                <th class="px-3 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${rows.length > 0 ? rows : '<tr><td colspan="8" class="p-4 text-center text-gray-500">Ch∆∞a c√≥ h·ªì s∆° n√†o ·ªü b∆∞·ªõc Ho√†n thi·ªán.</td></tr>'}
                        </tbody>
                    </table>
                </div>
            `;
        };

        window.toggleSelectAllProfiles = (checkbox) => {
            const checkboxes = document.querySelectorAll('.profile-checkbox');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
            updateBulkSelectedCount();
        };

        window.updateBulkSelectedCount = () => {
            const count = document.querySelectorAll('.profile-checkbox:checked').length;
            // C·∫≠p nh·∫≠t n·∫øu modal ƒëang m·ªü
            const countElement = document.getElementById('bulkSelectedProfileCount');
            if (countElement) countElement.textContent = count;
        };

        window.openDocumentDetailModal = (profileId) => {
            const profile = mockData.find(d => d.id === profileId);
            if (!profile) return;
            currentDocProfileId = profileId;

            const mentor = profile.mentorId ? mockMentors.find(m => m.id === profile.mentorId) : null;
            const docs = profile.documents || {};
            const completedDocs = Object.values(docs).filter(v => v === true).length;
            const totalDocs = REQUIRED_DOCUMENTS.length;

            document.getElementById('docDetailName').textContent = profile.hoTen;
            document.getElementById('docDetailTitle').textContent = profile.chucDanh || 'N/A';
            document.getElementById('docDetailUnit').textContent = profile.donVi;
            document.getElementById('docDetailMentor').textContent = mentor ? mentor.hoTen : 'N/A';
            document.getElementById('docDetailProgress').textContent = `${completedDocs}/${totalDocs}`;

            // Render b·∫£ng checklist 6 t√†i li·ªáu
            const checklistRows = REQUIRED_DOCUMENTS.map(doc => {
                const isSubmitted = docs[doc.id] === true;
                const statusIcon = isSubmitted 
                    ? '<span class="text-green-600 text-xl">‚úÖ</span>' 
                    : '<span class="text-red-600 text-xl">‚ùå</span>';
                
                const actionButton = `
                    <button onclick="toggleDocumentStatus(${profileId}, ${doc.id})" 
                        class="px-3 py-1 text-xs rounded ${isSubmitted ? 'bg-red-100 text-red-700 hover:bg-red-200' : 'bg-green-100 text-green-700 hover:bg-green-200'} transition">
                        ${isSubmitted ? 'ƒê√°nh d·∫•u Ch∆∞a n·ªôp' : 'ƒê√°nh d·∫•u ƒê√£ n·ªôp'}
                    </button>
                `;

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3 text-sm text-gray-700 text-center">${doc.id}</td>
                        <td class="p-3 text-sm text-gray-700">${doc.name}</td>
                        <td class="p-3 text-sm text-center">${statusIcon}</td>
                        <td class="p-3 text-sm text-right">${actionButton}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('documentChecklistTable').innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">STT</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">T√†i li·ªáu c·∫ßn n·ªôp</th>
                            <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i</th>
                            <th class="px-3 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${checklistRows}
                    </tbody>
                </table>
            `;

            openModal('modalDocumentDetail');
        };

        window.toggleDocumentStatus = (profileId, docId) => {
            const profile = mockData.find(d => d.id === profileId);
            if (!profile) return;
            
            if (!profile.documents) profile.documents = {};
            profile.documents[docId] = !profile.documents[docId];

            // Ki·ªÉm tra xem ƒë√£ ƒë·ªß 6/6 t√†i li·ªáu ch∆∞a
            const completedDocs = Object.values(profile.documents).filter(v => v === true).length;
            const totalDocs = REQUIRED_DOCUMENTS.length;

            if (completedDocs === totalDocs && profile.trangThai === STEPS.HOAN_THIEN) {
                // T·ª± ƒë·ªông chuy·ªÉn sang b∆∞·ªõc Quy·∫øt ƒë·ªãnh k·∫øt n·∫°p
                updateRecordProgress(profileId, STEPS.HOAN_THIEN, 'Ho√†n th√†nh', `ƒê√£ n·ªôp ƒë·ªß ${totalDocs}/${totalDocs} t√†i li·ªáu.`);
            } else {
                // C·∫≠p nh·∫≠t ghi ch√∫ ti·∫øn ƒë·ªô
                const progressItem = profile.progress.find(p => p.step === STEPS.HOAN_THIEN);
                if (progressItem) {
                    progressItem.note = `ƒêang ho√†n thi·ªán h·ªì s∆° (${completedDocs}/${totalDocs} t√†i li·ªáu)`;
                }
            }

            // Re-render
            openDocumentDetailModal(profileId); // Refresh modal
            renderDocumentCompletionTable();
            renderQCTable(); // C·∫≠p nh·∫≠t b·∫£ng t·ªïng
        };

        window.openBulkUpdateModal = () => {
            const profilesInDocCompletion = mockData.filter(d => 
                d.currentStepIndex >= Object.values(STEPS).indexOf(STEPS.HOAN_THIEN)
            );
            
            // Render danh s√°ch h·ªì s∆°
            const profileListHTML = profilesInDocCompletion.map(profile => `
                <label class="flex items-center p-2 hover:bg-gray-100 rounded">
                    <input type="checkbox" data-bulk-profile-id="${profile.id}" class="form-checkbox text-primary-red h-4 w-4 rounded mr-2 bulk-profile-checkbox" onchange="updateBulkCounts()">
                    <span class="text-sm text-gray-700">${profile.hoTen} - ${profile.donVi}</span>
                </label>
            `).join('');

            document.getElementById('bulkProfileList').innerHTML = profileListHTML.length > 0 
                ? profileListHTML 
                : '<p class="p-3 text-center text-gray-500">Kh√¥ng c√≥ h·ªì s∆° n√†o.</p>';

            // Render danh s√°ch 6 t√†i li·ªáu
            const documentListHTML = REQUIRED_DOCUMENTS.map(doc => `
                <label class="flex items-center p-2 hover:bg-gray-100 rounded">
                    <input type="checkbox" data-doc-id="${doc.id}" class="form-checkbox text-primary-red h-4 w-4 rounded mr-2 bulk-doc-checkbox" onchange="updateBulkCounts()">
                    <span class="text-sm text-gray-700">${doc.id}. ${doc.name}</span>
                </label>
            `).join('');

            document.getElementById('bulkDocumentList').innerHTML = documentListHTML;

            // Reset counts
            document.getElementById('bulkSelectedProfileCount').textContent = '0';
            document.getElementById('bulkSelectedDocCount').textContent = '0';

            openModal('modalBulkUpdate');
        };

        window.updateBulkCounts = () => {
            const profileCount = document.querySelectorAll('.bulk-profile-checkbox:checked').length;
            const docCount = document.querySelectorAll('.bulk-doc-checkbox:checked').length;
            
            document.getElementById('bulkSelectedProfileCount').textContent = profileCount;
            document.getElementById('bulkSelectedDocCount').textContent = docCount;
        };

        window.handleBulkUpdate = (event) => {
            event.preventDefault();
            
            const selectedProfileIds = Array.from(document.querySelectorAll('.bulk-profile-checkbox:checked'))
                .map(cb => parseInt(cb.dataset.bulkProfileId));
            
            const selectedDocIds = Array.from(document.querySelectorAll('.bulk-doc-checkbox:checked'))
                .map(cb => parseInt(cb.dataset.docId));
            
            const status = document.querySelector('input[name="bulkStatus"]:checked')?.value === 'true';

            if (selectedProfileIds.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt h·ªì s∆°.');
                return;
            }

            if (selectedDocIds.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt lo·∫°i t√†i li·ªáu.');
                return;
            }

            // C·∫≠p nh·∫≠t h√†ng lo·∫°t
            selectedProfileIds.forEach(profileId => {
                const profile = mockData.find(d => d.id === profileId);
                if (profile) {
                    if (!profile.documents) profile.documents = {};
                    
                    selectedDocIds.forEach(docId => {
                        profile.documents[docId] = status;
                    });

                    // Ki·ªÉm tra tr·∫°ng th√°i t·ªïng
                    const completedDocs = Object.values(profile.documents).filter(v => v === true).length;
                    const totalDocs = REQUIRED_DOCUMENTS.length;

                    if (completedDocs === totalDocs && profile.trangThai === STEPS.HOAN_THIEN) {
                        updateRecordProgress(profileId, STEPS.HOAN_THIEN, 'Ho√†n th√†nh', `ƒê√£ n·ªôp ƒë·ªß ${totalDocs}/${totalDocs} t√†i li·ªáu.`);
                    } else {
                        const progressItem = profile.progress.find(p => p.step === STEPS.HOAN_THIEN);
                        if (progressItem && profile.trangThai === STEPS.HOAN_THIEN) {
                            progressItem.note = `ƒêang ho√†n thi·ªán h·ªì s∆° (${completedDocs}/${totalDocs} t√†i li·ªáu)`;
                        }
                    }
                }
            });

            closeModal('modalBulkUpdate');
            renderDocumentCompletionTable();
            renderQCTable();
            
            alert(`ƒê√£ c·∫≠p nh·∫≠t ${selectedDocIds.length} lo·∫°i t√†i li·ªáu cho ${selectedProfileIds.length} h·ªì s∆° th√†nh c√¥ng!`);
        };

        // --- LOGIC FOR TAB: Quy·∫øt ƒë·ªãnh K·∫øt n·∫°p (QDKN) ---

        const renderAdmissionDecisionTable = () => {
            // L·∫•y danh s√°ch h·ªì s∆° ƒë√£ ho√†n th√†nh Ho√†n thi·ªán h·ªì s∆° (ƒë·ªß 6/6 t√†i li·ªáu)
            const profilesForAdmission = mockData.filter(d => 
                d.currentStepIndex >= Object.values(STEPS).indexOf(STEPS.KET_NAP)
            );
            
            const rows = profilesForAdmission.map(profile => {
                const ketNapStatus = profile.ketNapStatus || "ƒêang th·ª±c hi·ªán";
                const completedDate = profile.ketNapCompletedDate 
                    ? new Date(profile.ketNapCompletedDate).toLocaleDateString('vi-VN')
                    : 'N/A';
                
                // T√¨m ng√†y ho√†n th√†nh b∆∞·ªõc Ho√†n thi·ªán h·ªì s∆°
                const hoanThienProgress = profile.progress.find(p => p.step === STEPS.HOAN_THIEN);
                const hoanThienDate = hoanThienProgress && hoanThienProgress.end !== 'N/A' 
                    ? hoanThienProgress.end 
                    : 'N/A';

                let statusBadge = getStatusBadge(ketNapStatus);
                
                // Dropdown tr·∫°ng th√°i
                const statusDropdown = `
                    <select onchange="updateAdmissionStatus(${profile.id}, this.value)" 
                        class="text-sm border rounded px-2 py-1 ${
                            ketNapStatus === 'Ho√†n th√†nh' ? 'bg-green-50 border-green-300 text-green-700 font-semibold' :
                            ketNapStatus === 'Kh√¥ng ho√†n th√†nh' ? 'bg-red-50 border-red-300 text-red-700' :
                            'bg-yellow-50 border-yellow-300 text-yellow-700'
                        }">
                        <option value="ƒêang th·ª±c hi·ªán" ${ketNapStatus === 'ƒêang th·ª±c hi·ªán' ? 'selected' : ''}>ƒêang th·ª±c hi·ªán</option>
                        <option value="Kh√¥ng ho√†n th√†nh" ${ketNapStatus === 'Kh√¥ng ho√†n th√†nh' ? 'selected' : ''}>Kh√¥ng ho√†n th√†nh</option>
                        <option value="Ho√†n th√†nh" ${ketNapStatus === 'Ho√†n th√†nh' ? 'selected' : ''}>Ho√†n th√†nh</option>
                    </select>
                `;

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3">
                            <input type="checkbox" data-admission-id="${profile.id}" class="form-checkbox text-primary-red h-4 w-4 rounded admission-checkbox" onchange="updateAdmissionBulkCount()">
                        </td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap font-medium">${profile.hoTen}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${profile.maNV || 'N/A'}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${profile.gioiTinh}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${new Date(profile.ngaySinh).toLocaleDateString('vi-VN')}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${profile.chucDanh || 'N/A'}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${profile.donVi}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${hoanThienDate}</td>
                        <td class="p-3 text-sm whitespace-nowrap">${statusDropdown}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-center">
                            <button onclick="viewAdmissionDetail(${profile.id})" class="text-indigo-600 hover:text-indigo-800" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            return `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Danh s√°ch Quy·∫øt ƒë·ªãnh K·∫øt n·∫°p</h2>
                    <button onclick="openBulkAdmissionModal()" class="bg-primary-red text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition shadow-md">
                        <i class="fas fa-sync-alt mr-2"></i> C·∫≠p nh·∫≠t H√†ng lo·∫°t
                    </button>
                </div>
                
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded">
                    <div class="flex items-start">
                        <i class="fas fa-info-circle text-blue-500 text-xl mr-3 mt-1"></i>
                        <div>
                            <h4 class="font-semibold text-blue-800 mb-1">Quy t·∫Øc nghi·ªáp v·ª•:</h4>
                            <p class="text-sm text-blue-700">
                                Khi c·∫≠p nh·∫≠t tr·∫°ng th√°i = <strong>"Ho√†n th√†nh"</strong>, h·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông:
                            </p>
                            <ul class="text-sm text-blue-700 list-disc list-inside mt-2 space-y-1">
                                <li>T·∫°o m·ªõi b·∫£n ghi t·∫°i ph√¢n h·ªá <strong>H·ªì s∆° ƒê·∫£ng vi√™n</strong></li>
                                <li>Copy to√†n b·ªô th√¥ng tin c∆° b·∫£n t·ª´ h·ªì s∆° ph√°t tri·ªÉn</li>
                                <li>G√°n <strong>Ch·ª©c danh ƒê·∫£ng = "ƒê·∫£ng vi√™n d·ª± b·ªã"</strong></li>
                                <li>G√°n <strong>Ng√†y ti·∫øp nh·∫≠n = Ng√†y c·∫≠p nh·∫≠t tr·∫°ng th√°i</strong></li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">
                                    <input type="checkbox" id="selectAllAdmission" class="form-checkbox text-primary-red h-4 w-4 rounded" onchange="toggleSelectAllAdmission(this)">
                                </th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">H·ªç v√† t√™n</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">M√£ NV</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Gi·ªõi t√≠nh</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y sinh</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ch·ª©c danh</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">B·ªô ph·∫≠n</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y HT Ho√†n thi·ªán HS</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i k·∫øt n·∫°p</th>
                                <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${rows.length > 0 ? rows : '<tr><td colspan="10" class="p-4 text-center text-gray-500">Ch∆∞a c√≥ h·ªì s∆° n√†o s·∫µn s√†ng k·∫øt n·∫°p.</td></tr>'}
                        </tbody>
                    </table>
                </div>
                
                ${mockPartyMembers.length > 0 ? `
                    <div class="mt-8 bg-green-50 border-l-4 border-green-500 p-4 rounded">
                        <div class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 text-xl mr-3 mt-1"></i>
                            <div class="flex-1">
                                <h4 class="font-semibold text-green-800 mb-2">ƒê√£ chuy·ªÉn sang Ph√¢n h·ªá ƒê·∫£ng vi√™n (${mockPartyMembers.length})</h4>
                                <div class="space-y-2">
                                    ${mockPartyMembers.map(pm => `
                                        <div class="bg-white p-3 rounded border border-green-200 text-sm">
                                            <span class="font-semibold text-gray-700">${pm.hoTen}</span> 
                                            <span class="text-gray-500">(${pm.maNV})</span> - 
                                            <span class="text-green-700 font-medium">${pm.chucDanhDang}</span> - 
                                            <span class="text-gray-500">Ng√†y ti·∫øp nh·∫≠n: ${new Date(pm.ngayTiepNhanDang).toLocaleDateString('vi-VN')}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                ` : ''}
            `;
        };

        window.toggleSelectAllAdmission = (checkbox) => {
            const checkboxes = document.querySelectorAll('.admission-checkbox');
            checkboxes.forEach(cb => cb.checked = checkbox.checked);
            updateAdmissionBulkCount();
        };

        window.updateAdmissionBulkCount = () => {
            const count = document.querySelectorAll('.admission-checkbox:checked').length;
            const countElement = document.getElementById('bulkAdmissionSelectedCount');
            if (countElement) countElement.textContent = count;
        };

        window.updateAdmissionStatus = (profileId, newStatus) => {
            const profile = mockData.find(d => d.id === profileId);
            if (!profile) return;

            const oldStatus = profile.ketNapStatus;
            profile.ketNapStatus = newStatus;

            if (newStatus === 'Ho√†n th√†nh') {
                const now = new Date();
                profile.ketNapCompletedDate = now.toISOString().substring(0, 10);

                // C·∫≠p nh·∫≠t ti·∫øn tr√¨nh
                updateRecordProgress(profileId, STEPS.KET_NAP, 'Ho√†n th√†nh', `Ho√†n th√†nh Quy·∫øt ƒë·ªãnh k·∫øt n·∫°p. Chuy·ªÉn sang ƒê·∫£ng vi√™n d·ª± b·ªã.`);

                // T·∫°o b·∫£n ghi trong Ph√¢n h·ªá ƒê·∫£ng vi√™n
                createPartyMemberRecord(profile);

                alert(`‚úÖ ƒê√£ ho√†n th√†nh k·∫øt n·∫°p cho ${profile.hoTen}.\n\nüìã H·ªì s∆° ƒë√£ ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·∫°i Ph√¢n h·ªá ƒê·∫£ng vi√™n v·ªõi ch·ª©c danh "ƒê·∫£ng vi√™n d·ª± b·ªã".`);
            } else if (newStatus === 'Kh√¥ng ho√†n th√†nh') {
                updateRecordProgress(profileId, STEPS.KET_NAP, 'Kh√¥ng ho√†n th√†nh', `K·∫øt n·∫°p kh√¥ng ho√†n th√†nh.`);
            } else {
                updateRecordProgress(profileId, STEPS.KET_NAP, 'ƒêang th·ª±c hi·ªán', `ƒêang x·ª≠ l√Ω quy·∫øt ƒë·ªãnh k·∫øt n·∫°p.`);
            }

            renderAdmissionDecisionTable();
            renderQCTable();
        };

        window.createPartyMemberRecord = (profile) => {
            const now = new Date();
            
            const partyMember = {
                id: mockPartyMembers.length > 0 ? Math.max(...mockPartyMembers.map(m => m.id)) + 1 : 1,
                originalProfileId: profile.id, // Li√™n k·∫øt v·ªõi h·ªì s∆° g·ªëc
                
                // Copy th√¥ng tin c∆° b·∫£n
                hoTen: profile.hoTen,
                maNV: profile.maNV,
                gioiTinh: profile.gioiTinh,
                ngaySinh: profile.ngaySinh,
                cccd: profile.cccd,
                diaChiThuongTru: profile.diaChiThuongTru,
                donVi: profile.donVi,
                chucDanh: profile.chucDanh,
                
                // Th√¥ng tin ƒê·∫£ng
                chucDanhDang: "ƒê·∫£ng vi√™n d·ª± b·ªã",
                ngayTiepNhanDang: now.toISOString().substring(0, 10),
                ngayKetNap: now.toISOString().substring(0, 10),
                trangThaiDang: "ƒêang ho·∫°t ƒë·ªông",
                
                // Metadata
                createdDate: now.toISOString(),
                createdBy: "System Auto"
            };

            mockPartyMembers.push(partyMember);
            console.log(`‚úÖ ƒê√£ t·∫°o H·ªì s∆° ƒê·∫£ng vi√™n ID: ${partyMember.id} cho ${partyMember.hoTen}`);
        };

        window.viewAdmissionDetail = (profileId) => {
            // M·ªü slide-in v·ªõi th√¥ng tin chi ti·∫øt
            openSlideIn(profileId);
        };

        window.openBulkAdmissionModal = () => {
            const profilesForAdmission = mockData.filter(d => 
                d.currentStepIndex >= Object.values(STEPS).indexOf(STEPS.KET_NAP)
            );
            
            // Render danh s√°ch h·ªì s∆°
            const profileListHTML = profilesForAdmission.map(profile => {
                const ketNapStatus = profile.ketNapStatus || "ƒêang th·ª±c hi·ªán";
                let statusBadgeClass = 'bg-yellow-100 text-yellow-700';
                if (ketNapStatus === 'Ho√†n th√†nh') statusBadgeClass = 'bg-green-100 text-green-700';
                else if (ketNapStatus === 'Kh√¥ng ho√†n th√†nh') statusBadgeClass = 'bg-red-100 text-red-700';

                return `
                    <label class="flex items-center justify-between p-3 hover:bg-gray-100 rounded border">
                        <div class="flex items-center flex-1">
                            <input type="checkbox" data-bulk-admission-id="${profile.id}" class="form-checkbox text-primary-red h-4 w-4 rounded mr-3 bulk-admission-checkbox" onchange="updateBulkAdmissionCounts()">
                            <div>
                                <p class="text-sm font-semibold text-gray-700">${profile.hoTen} <span class="text-gray-500">(${profile.maNV || 'N/A'})</span></p>
                                <p class="text-xs text-gray-500">${profile.donVi}</p>
                            </div>
                        </div>
                        <span class="px-2 py-1 text-xs font-semibold rounded-full ${statusBadgeClass}">${ketNapStatus}</span>
                    </label>
                `;
            }).join('');

            document.getElementById('bulkAdmissionProfileList').innerHTML = profileListHTML.length > 0 
                ? profileListHTML 
                : '<p class="p-3 text-center text-gray-500">Kh√¥ng c√≥ h·ªì s∆° n√†o.</p>';

            // Reset count
            document.getElementById('bulkAdmissionSelectedCount').textContent = '0';

            openModal('modalBulkAdmission');
        };

        window.updateBulkAdmissionCounts = () => {
            const count = document.querySelectorAll('.bulk-admission-checkbox:checked').length;
            document.getElementById('bulkAdmissionSelectedCount').textContent = count;
        };

        window.handleBulkAdmission = (event) => {
            event.preventDefault();
            
            const selectedProfileIds = Array.from(document.querySelectorAll('.bulk-admission-checkbox:checked'))
                .map(cb => parseInt(cb.dataset.bulkAdmissionId));
            
            const newStatus = document.querySelector('input[name="bulkAdmissionStatus"]:checked')?.value;

            if (selectedProfileIds.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt h·ªì s∆°.');
                return;
            }

            if (!newStatus) {
                alert('Vui l√≤ng ch·ªçn tr·∫°ng th√°i k·∫øt n·∫°p.');
                return;
            }

            // X√°c nh·∫≠n n·∫øu ch·ªçn "Ho√†n th√†nh"
            if (newStatus === 'Ho√†n th√†nh') {
                const confirmMsg = `B·∫°n ƒëang c·∫≠p nh·∫≠t ${selectedProfileIds.length} h·ªì s∆° sang tr·∫°ng th√°i "Ho√†n th√†nh".\n\n` +
                    `H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông t·∫°o ${selectedProfileIds.length} b·∫£n ghi t·∫°i Ph√¢n h·ªá ƒê·∫£ng vi√™n v·ªõi ch·ª©c danh "ƒê·∫£ng vi√™n d·ª± b·ªã".\n\n` +
                    `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ti·∫øp t·ª•c?`;
                
                if (!confirm(confirmMsg)) {
                    return;
                }
            }

            // C·∫≠p nh·∫≠t h√†ng lo·∫°t
            let completedCount = 0;
            selectedProfileIds.forEach(profileId => {
                const profile = mockData.find(d => d.id === profileId);
                if (profile) {
                    const oldStatus = profile.ketNapStatus;
                    profile.ketNapStatus = newStatus;

                    if (newStatus === 'Ho√†n th√†nh') {
                        const now = new Date();
                        profile.ketNapCompletedDate = now.toISOString().substring(0, 10);
                        
                        updateRecordProgress(profileId, STEPS.KET_NAP, 'Ho√†n th√†nh', `Ho√†n th√†nh Quy·∫øt ƒë·ªãnh k·∫øt n·∫°p. Chuy·ªÉn sang ƒê·∫£ng vi√™n d·ª± b·ªã.`);
                        createPartyMemberRecord(profile);
                        completedCount++;
                    } else if (newStatus === 'Kh√¥ng ho√†n th√†nh') {
                        updateRecordProgress(profileId, STEPS.KET_NAP, 'Kh√¥ng ho√†n th√†nh', `K·∫øt n·∫°p kh√¥ng ho√†n th√†nh.`);
                    } else {
                        updateRecordProgress(profileId, STEPS.KET_NAP, 'ƒêang th·ª±c hi·ªán', `ƒêang x·ª≠ l√Ω quy·∫øt ƒë·ªãnh k·∫øt n·∫°p.`);
                    }
                }
            });

            closeModal('modalBulkAdmission');
            renderAdmissionDecisionTable();
            renderQCTable();

            if (completedCount > 0) {
                alert(`‚úÖ ƒê√£ ho√†n th√†nh k·∫øt n·∫°p cho ${completedCount} h·ªì s∆°.\n\nüìã ${completedCount} h·ªì s∆° ƒë√£ ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·∫°i Ph√¢n h·ªá ƒê·∫£ng vi√™n v·ªõi ch·ª©c danh "ƒê·∫£ng vi√™n d·ª± b·ªã".`);
            } else {
                alert(`ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i cho ${selectedProfileIds.length} h·ªì s∆° th√†nh c√¥ng!`);
            }
        };

        // --- LOGIC FOR TAB: R√®n Luy·ªán Th·ª≠ Th√°ch (RLTT) ---

        const renderMentorTable = () => {
            const assignedMentors = mockMentors.filter(m => m.isAssigned);
            
            const rows = assignedMentors.map(mentor => {
                const studentCount = mockData.filter(d => d.mentorId === mentor.id).length;
                
                let actions = `
                    <button onclick="event.stopPropagation(); openMentorDetailModal(${mentor.id});" class="text-indigo-600 hover:text-indigo-800 mr-2" title="Xem Chi ti·∫øt & G√°n h·ªì s∆°"><i class="fas fa-eye"></i></button>
                    <button onclick="event.stopPropagation(); removeMentor(${mentor.id});" class="text-red-600 hover:text-red-800" title="X√≥a Ng∆∞·ªùi H∆∞·ªõng D·∫´n"><i class="fas fa-user-times"></i></button>
                `;

                return `
                    <tr class="hover:bg-gray-50 cursor-pointer" onclick="openMentorDetailModal(${mentor.id})">
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap font-medium">${mentor.hoTen}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${mentor.maDV}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${mentor.chucDanh}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${mentor.boPhan}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-center font-bold text-primary-red">${studentCount}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">${actions}</td>
                    </tr>
                `;
            }).join('');

            return `
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold text-gray-800">Danh s√°ch Ng∆∞·ªùi H∆∞·ªõng D·∫´n R√®n Luy·ªán</h2>
                    <button onclick="openAddMentorModal()" class="bg-primary-red text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-700 transition shadow-md">
                        <i class="fas fa-plus mr-2"></i> Th√™m Ng∆∞·ªùi H∆∞·ªõng D·∫´n
                    </button>
                </div>
                
                <div class="overflow-x-auto bg-white rounded-lg shadow">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">H·ªç v√† t√™n</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">M√£ ƒê·∫£ng vi√™n</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ch·ª©c danh</th>
                                <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">B·ªô ph·∫≠n</th>
                                <th class="px-3 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider">S·ªë h·ªì s∆° ƒëang h∆∞·ªõng d·∫´n</th>
                                <th class="px-3 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${rows.length > 0 ? rows : '<tr><td colspan="6" class="p-4 text-center text-gray-500">Ch∆∞a c√≥ ng∆∞·ªùi h∆∞·ªõng d·∫´n n√†o ƒë∆∞·ª£c th√™m.</td></tr>'}
                        </tbody>
                    </table>
                </div>
            `;
        };

        window.openAddMentorModal = () => {
            const availableMentors = mockMentors.filter(m => !m.isAssigned);
            
            const listHTML = availableMentors.map(mentor => `
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border">
                    <div class="flex items-center">
                        <input type="checkbox" data-id="${mentor.id}" onchange="updateSelectedMentorCount()" class="form-checkbox text-primary-red h-5 w-5 rounded mr-3">
                        <div>
                            <p class="text-sm font-semibold text-gray-800">${mentor.hoTen} (${mentor.maDV})</p>
                            <p class="text-xs text-gray-500">${mentor.chucDanh} - ${mentor.boPhan}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('availableMentorList').innerHTML = listHTML.length > 0 ? listHTML : '<p class="p-3 text-center text-gray-500">Kh√¥ng c√≤n ƒê·∫£ng vi√™n n√†o kh·∫£ d·ª•ng ƒë·ªÉ g√°n h∆∞·ªõng d·∫´n.</p>';
            document.getElementById('selectedMentorCount').textContent = '0';
            openModal('modalAddMentor');
        };

        window.updateSelectedMentorCount = () => {
            const count = document.querySelectorAll('#availableMentorList input[type="checkbox"]:checked').length;
            document.getElementById('selectedMentorCount').textContent = count;
        };

        window.addSelectedMentors = () => {
            const selectedIds = Array.from(document.querySelectorAll('#availableMentorList input[type="checkbox"]:checked'))
                .map(checkbox => parseInt(checkbox.dataset.id));

            if (selectedIds.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ƒê·ªìng ch√≠.');
                return;
            }

            selectedIds.forEach(id => {
                const mentor = mockMentors.find(m => m.id === id);
                if (mentor) {
                    mentor.isAssigned = true; // ƒê√°nh d·∫•u ƒë√£ ƒë∆∞·ª£c g√°n v√†o danh s√°ch qu·∫£n l√Ω
                }
            });

            closeModal('modalAddMentor');
            renderMentorTable(); 
            alert(`ƒê√£ th√™m ${selectedIds.length} Ng∆∞·ªùi H∆∞·ªõng D·∫´n th√†nh c√¥ng!`);
        };

        window.removeMentor = (mentorId) => {
            if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën lo·∫°i b·ªè Ng∆∞·ªùi H∆∞·ªõng D·∫´n n√†y? T·∫•t c·∫£ h·ªì s∆° ƒëang h∆∞·ªõng d·∫´n s·∫Ω b·ªã m·∫•t ph√¢n c√¥ng.")) return;

            const mentor = mockMentors.find(m => m.id === mentorId);
            if (mentor) {
                // ƒê√°nh d·∫•u mentor kh√¥ng c√≤n ƒë∆∞·ª£c qu·∫£n l√Ω
                mentor.isAssigned = false; 

                // Lo·∫°i b·ªè ph√¢n c√¥ng kh·ªèi t·∫•t c·∫£ h·ªçc vi√™n
                mockData.forEach(d => {
                    if (d.mentorId === mentorId) {
                        d.mentorId = null;
                        d.trainingStatus = null;
                        d.trainingStartDate = null;
                    }
                });

                renderMentorTable();
            }
        };

        window.openMentorDetailModal = (mentorId) => {
            const mentor = mockMentors.find(m => m.id === mentorId);
            if (!mentor) return;
            currentMentorId = mentorId;

            const students = mockData.filter(d => d.mentorId === mentorId);

            document.getElementById('detailMentorName').textContent = mentor.hoTen;
            document.getElementById('detailMentorCode').textContent = mentor.maDV;
            document.getElementById('detailMentorTitle').textContent = mentor.chucDanh;
            document.getElementById('detailMentorDept').textContent = mentor.boPhan;
            document.getElementById('detailMentorStudentCount').textContent = students.length;
            document.getElementById('currentMentorStudentCount').textContent = students.length;

            renderMentorStudentList(mentorId);
            openModal('modalMentorDetail');
        };

        const renderMentorStudentList = (mentorId) => {
            const studentsInTraining = mockData.filter(d => d.mentorId === mentorId);
            const total = studentsInTraining.length;

            document.getElementById('detailMentorStudentCount').textContent = total;
            document.getElementById('currentMentorStudentCount').textContent = total;

            const studentRows = studentsInTraining.map(student => {
                let status = student.trainingStatus || "ƒêang r√®n luy·ªán";
                let actions = '';
                
                // N√∫t c·∫≠p nh·∫≠t tr·∫°ng th√°i
                if (status === "ƒêang r√®n luy·ªán") {
                    actions = `
                        <button onclick="event.stopPropagation(); updateTrainingStatus(${student.id}, 'Ho√†n th√†nh');" class="text-green-600 hover:text-green-800 mr-2" title="C·∫≠p nh·∫≠t Ho√†n th√†nh"><i class="fas fa-award"></i></button>
                        <button onclick="event.stopPropagation(); updateTrainingStatus(${student.id}, 'Kh√¥ng ho√†n th√†nh');" class="text-yellow-600 hover:text-yellow-800 mr-2" title="C·∫≠p nh·∫≠t Kh√¥ng ho√†n th√†nh"><i class="fas fa-times-circle"></i></button>
                    `;
                }
                actions += `<button onclick="event.stopPropagation(); removeStudentFromMentor(${student.id});" class="text-red-600 hover:text-red-800" title="X√≥a kh·ªèi h∆∞·ªõng d·∫´n"><i class="fas fa-user-times"></i></button>`;
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${student.hoTen}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${student.chucDanh || 'N/A'}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${student.donVi}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap">${new Date(student.trainingStartDate).toLocaleDateString('vi-VN')}</td>
                        <td class="p-3 text-sm whitespace-nowrap">${getStatusBadge(status)}</td>
                        <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">${actions}</td>
                    </tr>
                `;
            }).join('');

            document.getElementById('mentorStudentList').innerHTML = `
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">H·ªç v√† t√™n</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ch·ª©c danh</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">B·ªô ph·∫≠n</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Ng√†y Bƒê R√®n luy·ªán</th>
                            <th class="px-3 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i r√®n luy·ªán</th>
                            <th class="px-3 py-3 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        ${studentRows.length > 0 ? studentRows : '<tr><td colspan="6" class="p-4 text-center text-gray-500">Ch∆∞a c√≥ h·ªì s∆° n√†o ƒëang ƒë∆∞·ª£c h∆∞·ªõng d·∫´n.</td></tr>'}
                    </tbody>
                </table>
            `;
        };

        window.openAssignStudentModal = () => {
            // Ch·ªâ l·∫•y h·ªì s∆° ƒë√£ ho√†n th√†nh L·ªõp Nh·∫≠n th·ª©c V√Ä ch∆∞a c√≥ mentorId
            const studentsForAssignment = mockData.filter(d => 
                d.trangThai === STEPS.LOP_NHAN_THUC && 
                d.classStatus === 'Ho√†n th√†nh' && 
                d.mentorId === null
            );
            
            const listHTML = studentsForAssignment.map(student => `
                <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm border">
                    <div class="flex items-center">
                        <input type="checkbox" data-id="${student.id}" onchange="updateAssignSelectedCount()" class="form-checkbox text-primary-red h-5 w-5 rounded mr-3">
                        <div>
                            <p class="text-sm font-semibold text-gray-800">${student.hoTen} (${student.maNV || 'N/A'})</p>
                            <p class="text-xs text-gray-500">${student.donVi}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('assignableStudentsList').innerHTML = listHTML.length > 0 ? listHTML : '<p class="p-3 text-center text-gray-500">Kh√¥ng c√≥ h·ªì s∆° n√†o ƒë·ªß ƒëi·ªÅu ki·ªán g√°n h∆∞·ªõng d·∫´n.</p>';
            document.getElementById('assignSelectedCount').textContent = '0';
            openModal('modalAssignStudents');
        };

        window.updateAssignSelectedCount = () => {
            const count = document.querySelectorAll('#modalAssignStudents input[type="checkbox"]:checked').length;
            document.getElementById('assignSelectedCount').textContent = count;
        };

        window.assignSelectedStudentsToMentor = () => {
            const selectedIds = Array.from(document.querySelectorAll('#modalAssignStudents input[type="checkbox"]:checked'))
                .map(checkbox => parseInt(checkbox.dataset.id));

            if (selectedIds.length === 0) {
                alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt h·ªì s∆° ƒë·ªÉ g√°n.');
                return;
            }

            const mentor = mockMentors.find(m => m.id === currentMentorId);
            if (!mentor) return;

            const now = new Date().toISOString().substring(0, 10); // Format YYYY-MM-DD for consistency

            selectedIds.forEach(id => {
                const record = mockData.find(d => d.id === id);
                if (record) {
                    // 1. G√°n v√†o Mentor
                    record.mentorId = currentMentorId;
                    record.trainingStatus = 'ƒêang r√®n luy·ªán';
                    record.trainingStartDate = now;
                    
                    // 2. C·∫≠p nh·∫≠t tr·∫°ng th√°i ti·∫øn tr√¨nh (B∆∞·ªõc: R√®n luy·ªán th·ª≠ th√°ch)
                    updateRecordProgress(id, STEPS.REN_LUYEN, 'ƒêang th·ª±c hi·ªán', `B·∫Øt ƒë·∫ßu r√®n luy·ªán v·ªõi ƒê/c ${mentor.hoTen}.`);
                }
            });

            closeModal('modalAssignStudents');
            renderMentorStudentList(currentMentorId); // C·∫≠p nh·∫≠t danh s√°ch h·ªì s∆° trong chi ti·∫øt mentor
            renderMentorTable(); // C·∫≠p nh·∫≠t b·∫£ng Mentor
            renderQCTable(); // C·∫≠p nh·∫≠t b·∫£ng QC∆ØT
            alert(`ƒê√£ g√°n ${selectedIds.length} h·ªì s∆° cho ƒê/c ${mentor.hoTen} th√†nh c√¥ng!`);
        };

        window.updateTrainingStatus = (studentId, status) => {
            const student = mockData.find(d => d.id === studentId);
            if (!student) return;
            
            student.trainingStatus = status;

            if (status === 'Ho√†n th√†nh') {
                // T·ª± ƒë·ªông chuy·ªÉn sang b∆∞·ªõc Ho√†n thi·ªán H·ªì s∆° qua updateRecordProgress
                updateRecordProgress(studentId, STEPS.REN_LUYEN, 'Ho√†n th√†nh', `Ho√†n th√†nh R√®n luy·ªán th·ª≠ th√°ch. Chuy·ªÉn sang Ho√†n thi·ªán h·ªì s∆°.`);
            } else {
                 // C·∫≠p nh·∫≠t timeline cho tr·∫°ng th√°i kh√°c (v√≠ d·ª•: Kh√¥ng ho√†n th√†nh)
                 updateRecordProgress(studentId, STEPS.REN_LUYEN, status, `K·∫øt qu·∫£ r√®n luy·ªán: ${status}.`);
            }
            
            renderMentorStudentList(currentMentorId);
            renderQCTable();
        };

        window.removeStudentFromMentor = (studentId) => {
             if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën H·ª¶Y ph√¢n c√¥ng h∆∞·ªõng d·∫´n cho h·ªì s∆° n√†y?")) return;
            const student = mockData.find(d => d.id === studentId);
            if (student) {
                const mentorId = student.mentorId;
                student.mentorId = null;
                student.trainingStatus = null;
                student.trainingStartDate = null;

                // C·∫≠p nh·∫≠t l·∫°i tr·∫°ng th√°i ti·∫øn tr√¨nh (quay v·ªÅ L·ªõp Nh·∫≠n th·ª©c - Ho√†n th√†nh)
                updateRecordProgress(studentId, STEPS.LOP_NHAN_THUC, 'Ho√†n th√†nh', `ƒê√£ h·ªßy ph√¢n c√¥ng h∆∞·ªõng d·∫´n. H·ªì s∆° s·∫µn s√†ng g√°n l·∫°i.`);

                renderMentorStudentList(mentorId);
                renderMentorTable();
            }
        };


        // --- Main Navigation Logic ---

        // Thi·∫øt l·∫≠p tab m·∫∑c ƒë·ªãnh l√† Quy·∫øt ƒë·ªãnh k·∫øt n·∫°p (theo y√™u c·∫ßu m·ªõi)
        const defaultTarget = 'lop-nhan-thuc';
        
        // C·∫≠p nh·∫≠t n·ªôi dung ch√≠nh
        const updateContent = (target) => {
            const stepElement = document.querySelector(`.nav-step[data-target="${target}"]`);
            if (target === 'quan-chung') {
                mainContent.innerHTML = renderQCTable();
            } else if (target === 'lop-nhan-thuc') {
                mainContent.innerHTML = renderClassTable();
            } else if (target === 'ren-luyen') {
                 mainContent.innerHTML = renderMentorTable();
            } else if (target === 'hoan-thien') {
                 mainContent.innerHTML = renderDocumentCompletionTable();
            } else if (target === 'ket-nap') {
                 mainContent.innerHTML = renderAdmissionDecisionTable();
            }
            else {
                // Placeholder cho c√°c m√†n h√¨nh kh√°c
                 mainContent.innerHTML = `
                    <div class="p-8 bg-white border border-gray-200 rounded-lg text-center shadow-inner">
                        <i class="fas fa-tools text-5xl text-gray-300 mb-4"></i>
                        <h2 class="text-2xl font-semibold text-gray-700">M√†n h√¨nh ${stepElement.getAttribute('data-title')}</h2>
                        <p class="text-gray-500 mt-2 max-w-lg mx-auto">
                            Ch·ª©c nƒÉng n√†y ƒëang ƒë∆∞·ª£c tri·ªÉn khai. Khu v·ª±c n√†y s·∫Ω hi·ªÉn th·ªã b·∫£ng qu·∫£n l√Ω ${stepElement.getAttribute('data-title')}.
                        </p>
                    </div>
                `;
            }
        };

        // --- QCUT Modal functions (Continued) ---

        document.getElementById('qcForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const id = document.getElementById('qcRecordId').value;
            
            // Helper: L·∫•y gi√° tr·ªã t·ª´ form
            const getFormValue = (field) => formData.get(field) || '';
            
            if (id) {
                // Edit existing record - C·∫≠p nh·∫≠t t·∫•t c·∫£ 44 tr∆∞·ªùng
                const record = mockData.find(d => d.id === parseInt(id));
                
                // I. Th√¥ng tin c∆° b·∫£n
                record.hoTen = getFormValue('hoTen');
                record.maNV = getFormValue('maNV');
                record.donVi = getFormValue('donVi');
                record.chiBoCha = getFormValue('chiBoCha');
                record.chucDanh = getFormValue('chucDanh');
                record.chucDanhChinhQuyen = getFormValue('chucDanhChinhQuyen');
                record.chucDanhDoanThe = getFormValue('chucDanhDoanThe');
                record.gioiTinh = getFormValue('gioiTinh');
                record.ngaySinh = getFormValue('ngaySinh');
                record.cccd = getFormValue('cccd');
                record.danToc = getFormValue('danToc');
                record.tonGiao = getFormValue('tonGiao');
                record.ngayTiepNhan = getFormValue('ngayTiepNhan');
                
                // II. ƒê·ªãa ch·ªâ
                record.noiSinhTP = getFormValue('noiSinhTP');
                record.noiSinhPhuong = getFormValue('noiSinhPhuong');
                record.diaChiNoiSinh = getFormValue('diaChiNoiSinh');
                record.queQuanTP = getFormValue('queQuanTP');
                record.queQuanPhuong = getFormValue('queQuanPhuong');
                record.diaChiQueQuan = getFormValue('diaChiQueQuan');
                record.noiOHienNayTP = getFormValue('noiOHienNayTP');
                record.noiOHienNayPhuong = getFormValue('noiOHienNayPhuong');
                record.diaChiNoiOHienNay = getFormValue('diaChiNoiOHienNay');
                record.thuongTruTP = getFormValue('thuongTruTP');
                record.diaChiThuongTru = getFormValue('diaChiThuongTru');
                record.thanhPhanGiaDinh = getFormValue('thanhPhanGiaDinh');
                
                // III. C√¥ng t√°c
                record.ngheNghiepTruocTuyenDung = getFormValue('ngheNghiepTruocTuyenDung');
                record.ngayTuyenDung = getFormValue('ngayTuyenDung');
                record.donViTuyenDung = getFormValue('donViTuyenDung');
                record.ngayVaoCoQuan = getFormValue('ngayVaoCoQuan');
                record.boPhanCongTac = getFormValue('boPhanCongTac');
                record.congTacChinhDangLam = getFormValue('congTacChinhDangLam');
                record.ngachCongChuc = getFormValue('ngachCongChuc');
                record.bacLuong = getFormValue('bacLuong');
                record.heSo = getFormValue('heSo');
                record.tuThang = getFormValue('tuThang');
                record.soTruongCongTac = getFormValue('soTruongCongTac');
                record.congViecLauNhat = getFormValue('congViecLauNhat');
                record.dienThoai = getFormValue('dienThoai');
                record.danhHieu = getFormValue('danhHieu');
                
                alert('‚úÖ ƒê√£ c·∫≠p nh·∫≠t h·ªì s∆° th√†nh c√¥ng!');
            } else {
                // Add new record - L∆∞u t·∫•t c·∫£ 44 tr∆∞·ªùng
                const newRecord = {
                    id: mockData.length > 0 ? Math.max(...mockData.map(d => d.id)) + 1 : 1,
                    
                    // I. Th√¥ng tin c∆° b·∫£n
                    hoTen: getFormValue('hoTen'),
                    maNV: getFormValue('maNV'),
                    donVi: getFormValue('donVi'),
                    chiBoCha: getFormValue('chiBoCha'),
                    chucDanh: getFormValue('chucDanh'),
                    chucDanhChinhQuyen: getFormValue('chucDanhChinhQuyen'),
                    chucDanhDoanThe: getFormValue('chucDanhDoanThe'),
                    gioiTinh: getFormValue('gioiTinh'),
                    ngaySinh: getFormValue('ngaySinh'),
                    cccd: getFormValue('cccd'),
                    danToc: getFormValue('danToc'),
                    tonGiao: getFormValue('tonGiao'),
                    ngayTiepNhan: getFormValue('ngayTiepNhan'),
                    
                    // II. ƒê·ªãa ch·ªâ
                    noiSinhTP: getFormValue('noiSinhTP'),
                    noiSinhPhuong: getFormValue('noiSinhPhuong'),
                    diaChiNoiSinh: getFormValue('diaChiNoiSinh'),
                    queQuanTP: getFormValue('queQuanTP'),
                    queQuanPhuong: getFormValue('queQuanPhuong'),
                    diaChiQueQuan: getFormValue('diaChiQueQuan'),
                    noiOHienNayTP: getFormValue('noiOHienNayTP'),
                    noiOHienNayPhuong: getFormValue('noiOHienNayPhuong'),
                    diaChiNoiOHienNay: getFormValue('diaChiNoiOHienNay'),
                    thuongTruTP: getFormValue('thuongTruTP'),
                    diaChiThuongTru: getFormValue('diaChiThuongTru'),
                    thanhPhanGiaDinh: getFormValue('thanhPhanGiaDinh'),
                    
                    // III. C√¥ng t√°c
                    ngheNghiepTruocTuyenDung: getFormValue('ngheNghiepTruocTuyenDung'),
                    ngayTuyenDung: getFormValue('ngayTuyenDung'),
                    donViTuyenDung: getFormValue('donViTuyenDung'),
                    ngayVaoCoQuan: getFormValue('ngayVaoCoQuan'),
                    boPhanCongTac: getFormValue('boPhanCongTac'),
                    congTacChinhDangLam: getFormValue('congTacChinhDangLam'),
                    ngachCongChuc: getFormValue('ngachCongChuc'),
                    bacLuong: getFormValue('bacLuong'),
                    heSo: getFormValue('heSo'),
                    tuThang: getFormValue('tuThang'),
                    soTruongCongTac: getFormValue('soTruongCongTac'),
                    congViecLauNhat: getFormValue('congViecLauNhat'),
                    dienThoai: getFormValue('dienThoai'),
                    danhHieu: getFormValue('danhHieu'),
                    
                    // Metadata h·ªá th·ªëng
                    trangThai: STEPS.QUAN_CHUNG,
                    currentStepIndex: 0,
                    classId: null,
                    classEntryDate: null,
                    classStatus: null,
                    mentorId: null,
                    trainingStatus: null,
                    trainingStartDate: null,
                    documents: { 1: false, 2: false, 3: false, 4: false, 5: false, 6: false },
                    ketNapStatus: null,
                    ketNapCompletedDate: null,
                    progress: [
                        { step: STEPS.QUAN_CHUNG, status: "ƒêang th·ª±c hi·ªán", start: new Date().toLocaleDateString('vi-VN'), end: "N/A", note: "H·ªì s∆° m·ªõi ƒë∆∞·ª£c ti·∫øp nh·∫≠n." },
                        { step: STEPS.CAM_TINH, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
                        { step: STEPS.LOP_NHAN_THUC, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
                        { step: STEPS.REN_LUYEN, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
                        { step: STEPS.HOAN_THIEN, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
                        { step: STEPS.KET_NAP, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
                        { step: STEPS.CHINH_THUC, status: "Ch∆∞a b·∫Øt ƒë·∫ßu", start: "N/A", end: "N/A", note: "" },
                    ]
                };
                mockData.push(newRecord);
                
                const fromHSNV = document.getElementById('fromHSNV').value === 'true';
                if (fromHSNV) {
                    alert(`‚úÖ ƒê√£ th√™m h·ªì s∆° m·ªõi t·ª´ HSNV th√†nh c√¥ng!\n\nüë§ ${newRecord.hoTen} (${newRecord.maNV})`);
                } else {
                    alert('‚úÖ ƒê√£ th√™m h·ªì s∆° m·ªõi th√†nh c√¥ng!');
                }
            }
            
            closeModal('modalDataEntry');
            document.getElementById('qcForm').reset();
            
            // Re-render UI
            const activeTarget = document.querySelector('.nav-step.active')?.getAttribute('data-target');
            if (activeTarget === 'quan-chung') {
                renderQCTable();
            }
        });
        
        window.deleteRecord = (id) => {
            if (confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªì s∆° n√†y?")) {
                mockData = mockData.filter(d => d.id !== id);
                renderQCTable();
            }
        };
        
        // --- Slide-in Detail Render (Updated with new STEPS) ---

        const renderDetailField = (label, value) => `
            <div>
                <span class="text-gray-500 font-medium">${label}:</span>
                <p class="text-gray-900 font-semibold">${value || 'N/A'}</p>
            </div>
        `;

        const renderDetailTabs = (record) => {
            // Tab 1: Th√¥ng tin C√° nh√¢n (Hi·ªÉn th·ªã ƒë·∫ßy ƒë·ªß 44 tr∆∞·ªùng)
            const infoContent = document.getElementById('detailInfoContent');
            const mentor = record.mentorId ? mockMentors.find(m => m.id === record.mentorId) : null;
            
            infoContent.innerHTML = `
                <!-- I. TH√îNG TIN C∆† B·∫¢N -->
                <div class="col-span-2 text-primary-red font-bold text-md border-b pb-2 mb-3">I. TH√îNG TIN C∆† B·∫¢N</div>
                ${renderDetailField("1. H·ªç v√† t√™n", record.hoTen)}
                ${renderDetailField("2. M√£ nh√¢n vi√™n", record.maNV || "N/A")}
                ${renderDetailField("3. ƒê∆°n v·ªã / Chi b·ªô", record.donVi)}
                ${renderDetailField("4. ƒê·∫£ng b·ªô/Chi b·ªô cha", record.chiBoCha || "N/A")}
                ${renderDetailField("5. Ch·ª©c danh", record.chucDanh)}
                ${renderDetailField("8. Ch·ª©c danh ch√≠nh quy·ªÅn", record.chucDanhChinhQuyen || "N/A")}
                ${renderDetailField("9. Ch·ª©c danh ƒëo√†n th·ªÉ", record.chucDanhDoanThe || "N/A")}
                ${renderDetailField("12. Gi·ªõi t√≠nh", record.gioiTinh)}
                ${renderDetailField("13. Ng√†y sinh", record.ngaySinh ? new Date(record.ngaySinh).toLocaleDateString('vi-VN') : "N/A")}
                ${renderDetailField("15. CMND/CCCD", record.cccd)}
                ${renderDetailField("16. D√¢n t·ªôc", record.danToc || "N/A")}
                ${renderDetailField("17. T√¥n gi√°o", record.tonGiao || "N/A")}
                ${renderDetailField("18. Ng√†y ti·∫øp nh·∫≠n", record.ngayTiepNhan ? new Date(record.ngayTiepNhan).toLocaleDateString('vi-VN') : "N/A")}
                
                <!-- II. TH√îNG TIN ƒê·ªäA CH·ªà -->
                <div class="col-span-2 text-primary-red font-bold text-md border-b pb-2 mb-3 mt-4">II. TH√îNG TIN ƒê·ªäA CH·ªà</div>
                ${renderDetailField("19. N∆°i sinh (T·ªânh/TP)", record.noiSinhTP || "N/A")}
                ${renderDetailField("20. N∆°i sinh (Ph∆∞·ªùng/X√£)", record.noiSinhPhuong || "N/A")}
                ${renderDetailField("21. ƒê·ªãa ch·ªâ n∆°i sinh", record.diaChiNoiSinh || "N/A")}
                ${renderDetailField("22. Qu√™ qu√°n (T·ªânh/TP)", record.queQuanTP || "N/A")}
                ${renderDetailField("23. Qu√™ qu√°n (Ph∆∞·ªùng/X√£)", record.queQuanPhuong || "N/A")}
                ${renderDetailField("24. ƒê·ªãa ch·ªâ qu√™ qu√°n", record.diaChiQueQuan || "N/A")}
                ${renderDetailField("25. N∆°i ·ªü hi·ªán nay (T·ªânh/TP)", record.noiOHienNayTP || "N/A")}
                ${renderDetailField("26. N∆°i ·ªü hi·ªán nay (Ph∆∞·ªùng/X√£)", record.noiOHienNayPhuong || "N/A")}
                ${renderDetailField("27. ƒê·ªãa ch·ªâ n∆°i ·ªü hi·ªán nay", record.diaChiNoiOHienNay || "N/A")}
                ${renderDetailField("28. T·ªânh/TP th∆∞·ªùng tr√∫", record.thuongTruTP || "N/A")}
                ${renderDetailField("29. ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫", record.diaChiThuongTru || "N/A")}
                ${renderDetailField("30. Th√†nh ph·∫ßn gia ƒë√¨nh", record.thanhPhanGiaDinh || "N/A")}
                
                <!-- III. TH√îNG TIN C√îNG T√ÅC -->
                <div class="col-span-2 text-primary-red font-bold text-md border-b pb-2 mb-3 mt-4">III. TH√îNG TIN C√îNG T√ÅC</div>
                ${renderDetailField("31. Ngh·ªÅ nghi·ªáp tr∆∞·ªõc khi tuy·ªÉn d·ª•ng", record.ngheNghiepTruocTuyenDung || "N/A")}
                ${renderDetailField("32. Ng√†y ƒë∆∞·ª£c tuy·ªÉn d·ª•ng", record.ngayTuyenDung ? new Date(record.ngayTuyenDung).toLocaleDateString('vi-VN') : "N/A")}
                ${renderDetailField("33. ƒê∆°n v·ªã tuy·ªÉn d·ª•ng", record.donViTuyenDung || "N/A")}
                ${renderDetailField("34. Ng√†y v√†o c∆° quan hi·ªán t·∫°i", record.ngayVaoCoQuan ? new Date(record.ngayVaoCoQuan).toLocaleDateString('vi-VN') : "N/A")}
                ${renderDetailField("35. B·ªô ph·∫≠n c√¥ng t√°c", record.boPhanCongTac || "N/A")}
                ${renderDetailField("36. C√¥ng t√°c ch√≠nh ƒëang l√†m", record.congTacChinhDangLam || "N/A")}
                ${renderDetailField("37. Ng·∫°ch c√¥ng ch·ª©c", record.ngachCongChuc || "N/A")}
                ${renderDetailField("38. B·∫≠c l∆∞∆°ng", record.bacLuong || "N/A")}
                ${renderDetailField("39. H·ªá s·ªë", record.heSo || "N/A")}
                ${renderDetailField("40. T·ª´ th√°ng", record.tuThang || "N/A")}
                ${renderDetailField("41. S·ªü tr∆∞·ªùng c√¥ng t√°c", record.soTruongCongTac || "N/A")}
                ${renderDetailField("42. C√¥ng vi·ªác ƒë√£ l√†m l√¢u nh·∫•t", record.congViecLauNhat || "N/A")}
                ${renderDetailField("43. ƒêi·ªán tho·∫°i", record.dienThoai || "N/A")}
                ${renderDetailField("44. Danh hi·ªáu phong t·∫∑ng", record.danhHieu || "N/A")}
                
                <!-- IV. TH√îNG TIN TI·∫æN TR√åNH -->
                <div class="col-span-2 text-primary-red font-bold text-md border-b pb-2 mb-3 mt-4">IV. TH√îNG TIN TI·∫æN TR√åNH</div>
                ${renderDetailField("Ng∆∞·ªùi h∆∞·ªõng d·∫´n", mentor ? `${mentor.hoTen} (${mentor.maDV})` : "Ch∆∞a ph√¢n c√¥ng")}
                ${renderDetailField("Tr·∫°ng th√°i r√®n luy·ªán", record.trainingStatus ? getStatusBadge(record.trainingStatus) : "N/A")}
            `;
            
            // Tab 2: Ti·∫øn ƒë·ªô 5 b∆∞·ªõc (Timeline)
            const progressContent = document.getElementById('progressTimeline');
            const progressSteps = record.progress || [];
            
            const timelineHTML = progressSteps.map(p => {
                let colorClass = 'bg-gray-400';
                let iconClass = 'fas fa-hourglass-start';
                let borderColor = 'border-gray-200';

                if (p.status.includes('Ho√†n th√†nh')) {
                    colorClass = 'bg-green-500';
                    iconClass = 'fas fa-check-circle';
                    borderColor = 'border-green-500';
                } else if (p.status.includes('ƒêang th·ª±c hi·ªán') || p.status.includes('ƒêang h·ªçc') || p.status.includes('ƒêang r√®n luy·ªán')) {
                    colorClass = 'bg-yellow-500';
                    iconClass = 'fas fa-running';
                    borderColor = 'border-yellow-500';
                }

                return `
                    <div class="flex">
                        <div class="flex flex-col items-center mr-4">
                            <div class="w-8 h-8 rounded-full ${colorClass} flex items-center justify-center text-white shadow-md">
                                <i class="${iconClass} text-sm"></i>
                            </div>
                            <div class="h-full w-0.5 ${borderColor}"></div>
                        </div>
                        <div class="flex-1 pb-8">
                            <h5 class="font-semibold text-gray-800">${p.step} <span class="text-xs font-normal ml-2 py-0.5 px-2 rounded-full text-white ${colorClass}">${p.status}</span></h5>
                            <p class="text-xs text-gray-500 mt-1">B·∫Øt ƒë·∫ßu: ${p.start} - K·∫øt th√∫c: ${p.end}</p>
                            ${p.note ? `<p class="text-sm italic text-gray-600 mt-2 p-3 bg-gray-50 rounded-lg border">${p.note}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            progressContent.innerHTML = timelineHTML;

            // X·ª≠ l√Ω chuy·ªÉn ƒë·ªïi tab
            const tabButtons = slideInDetailView.querySelectorAll('.tab-button');
            const tabContents = [document.getElementById('contentThongTin'), document.getElementById('contentTienDo')];
            
            tabButtons.forEach(button => {
                button.onclick = (e) => {
                    tabButtons.forEach(btn => {
                        btn.classList.remove('border-primary-red', 'text-primary-red');
                        btn.classList.add('border-transparent');
                    });
                    
                    e.currentTarget.classList.add('border-primary-red', 'text-primary-red');

                    tabContents.forEach(content => content.classList.add('hidden'));
                    document.getElementById(`content${e.currentTarget.dataset.tab.split('-').map(s => s.charAt(0).toUpperCase() + s.slice(1)).join('')}`).classList.remove('hidden');
                };
            });
            // ƒê·∫£m b·∫£o Tab 1 (Th√¥ng tin) lu√¥n active khi m·ªü slide-in
            document.getElementById('tabThongTin').click();
        };

        // X·ª≠ l√Ω chuy·ªÉn ƒë·ªïi Tab Navigation ch√≠nh
        navSteps.forEach(step => {
            // Ki·ªÉm tra v√† ƒë·∫∑t active cho tab m·∫∑c ƒë·ªãnh
            if (step.getAttribute('data-target') === defaultTarget) {
                 step.classList.add('active', 'border-primary-red');
                 step.querySelector('.step-icon').classList.remove('text-gray-500');
                 step.querySelector('.step-icon').classList.add('text-white');
                 updateContent(defaultTarget);
            } else {
                 step.classList.remove('active', 'border-primary-red');
                 step.classList.add('border-transparent');
                 step.querySelector('.step-icon').classList.remove('text-white');
                 step.querySelector('.step-icon').classList.add('text-gray-500');
            }

            step.addEventListener('click', function(e) {
                e.preventDefault(); 
                
                // 1. X·ª≠ l√Ω Highlight Tab
                navSteps.forEach(s => {
                    s.classList.remove('active', 'border-primary-red');
                    s.classList.add('border-transparent');
                    s.querySelector('.step-icon').classList.remove('text-white');
                    s.querySelector('.step-icon').classList.add('text-gray-500');
                });
                
                this.classList.add('active', 'border-primary-red');
                this.querySelector('.step-icon').classList.remove('text-gray-500');
                this.querySelector('.step-icon').classList.add('text-white');

                // 2. C·∫≠p nh·∫≠t N·ªôi dung
                updateContent(this.getAttribute('data-target'));
                console.log(`ƒê√£ chuy·ªÉn sang m√†n: ${this.getAttribute('data-title')}`);
            });
        });
    });
</script>

</body>
</html>